<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GFConcursos - Foco na Aprovação</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    
    <style type="text/css">@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}</style>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .timer-digits {
            font-variant-numeric: tabular-nums;
        }
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }
        .nav-item.active {
            color: #2563eb; /* text-blue-600 */
        }
        .nav-item.active svg {
            stroke: #2563eb;
        }
        .topics-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .subject-item.is-expanded .topics-container {
            max-height: 1000px; /* valor alto para permitir expansão */
        }
        .subject-item.is-expanded .chevron {
            transform: rotate(180deg);
        }
        /* Estilos do Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 50;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.is-open {
            display: flex;
        }
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            max-width: 90%;
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slide-up 0.3s ease-out;
        }
        @keyframes slide-up {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .summary-content h3 {
          font-size: 1.25rem;
          font-weight: 700;
          color: #1e3a8a; /* text-blue-900 */
          margin-top: 1.5rem;
          margin-bottom: 0.5rem;
          border-bottom: 2px solid #93c5fd; /* border-blue-300 */
          padding-bottom: 0.25rem;
        }
        .summary-content h4 {
          font-size: 1.1rem;
          font-weight: 600;
          color: #1e293b; /* text-slate-800 */
          margin-top: 1.25rem;
          margin-bottom: 0.5rem;
        }
        .summary-content p {
          color: #475569; /* text-slate-600 */
          line-height: 1.6;
          margin-bottom: 0.75rem;
        }
        .summary-content strong {
            font-weight: 600;
            color: #334155; /* text-slate-700 */
        }
        .progress-bar {
            background-color: #e5e7eb; /* bg-gray-200 */
            border-radius: 9999px;
            height: 1rem;
            overflow: hidden;
        }
        .progress-bar-inner {
            background-color: #2563eb; /* bg-blue-600 */
            height: 100%;
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="antialiased text-slate-800">

    <div id="app" class="max-w-lg mx-auto bg-white min-h-screen shadow-lg flex flex-col">
        
        <header class="bg-blue-600 text-white p-4 text-center shadow-md">
            <h1 class="text-2xl font-bold">GFConcursos</h1>
            <p id="header-subtitle" class="text-sm opacity-90">Seu parceiro rumo à aprovação</p>
        </header>

        <main class="flex-grow p-4 md:p-6 space-y-6 overflow-y-auto pb-24">
            
            <div id="view-cronometro" class="view active">
                 <div id="study-cycle-container" class="mb-6">
                    <h2 class="text-xl font-bold mb-3">Meu Ciclo de Estudo</h2>
                    <div class="bg-white p-4 rounded-lg shadow space-y-3">
                        <div id="cycle-setup">
                             <label for="cycle-goal-input" class="block text-sm font-medium text-slate-700">Definir meta de horas para o ciclo:</label>
                             <div class="flex items-center gap-2 mt-1">
                                 <input type="number" id="cycle-goal-input" placeholder="Ex: 100" min="1" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                                 <button id="set-cycle-goal-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">Definir</button>
                             </div>
                        </div>
                        <div id="cycle-progress" class="hidden space-y-2">
                            <div>
                                <div class="flex justify-between items-center text-sm font-medium text-slate-600">
                                    <span>Progresso</span>
                                    <span id="cycle-progress-percentage">0%</span>
                                </div>
                                <div class="progress-bar mt-1">
                                    <div id="cycle-progress-bar-inner" class="progress-bar-inner" style="width: 0%;"></div>
                                </div>
                                <p id="cycle-progress-text" class="text-xs text-slate-500 text-right mt-1">0h 0m / 0h</p>
                            </div>
                            <div id="cycle-completed-box" class="hidden bg-green-100 border border-green-200 text-green-700 text-center p-3 rounded-lg">
                                <p class="font-bold">🎉 Parabéns! Meta do ciclo concluída! 🎉</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-100 rounded-2xl p-6 text-center shadow-inner">
                    <p id="current-subject-display" class="text-lg font-semibold text-slate-600 mb-2 h-12 flex items-center justify-center text-center">Nenhuma disciplina selecionada</p>
                    <div id="timer-display" class="text-6xl md:text-7xl font-bold text-slate-800 timer-digits tracking-wider">
                        00:00:00
                    </div>
                    <div class="mt-6 flex justify-center space-x-3">
                        <button id="start-pause-btn" class="bg-blue-600 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                            <i data-lucide="play" class="w-5 h-5 mr-2"></i>
                            <span id="start-pause-text">Iniciar</span>
                        </button>
                        <button id="stop-btn" class="bg-red-500 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:bg-red-600 transition-all transform hover:scale-105 flex items-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                            <i data-lucide="square" class="w-5 h-5 mr-2"></i>
                            <span>Parar</span>
                        </button>
                    </div>
                </div>

                <div>
                    <h2 class="text-xl font-bold mb-3 mt-6">Minhas Disciplinas</h2>
                    <div class="bg-white rounded-lg">
                        <ul id="subjects-list" class="divide-y divide-slate-200">
                            </ul>
                    </div>
                     <div id="add-subject-container" class="mt-4 space-y-2">
                         <select id="new-subject-select" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white">
                             <option value="">Selecione uma disciplina do edital...</option>
                             <option value="Língua Portuguesa">Língua Portuguesa</option>
                             <option value="Raciocínio Lógico-Matemático">Raciocínio Lógico-Matemático</option>
                             <option value="História e Geografia de Rondônia">História e Geografia de Rondônia</option>
                             <option value="Direito Constitucional">Direito Constitucional</option>
                             <option value="Direito Administrativo">Direito Administrativo</option>
                             <option value="Legislação Específica">Legislação Específica</option>
                         </select>
                         <div class="flex items-center gap-2">
                            <hr class="flex-grow border-slate-200">
                            <span class="text-xs text-slate-500">OU</span>
                            <hr class="flex-grow border-slate-200">
                         </div>
                         <input type="text" id="custom-subject-input" placeholder="Digite uma disciplina personalizada" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                         <button id="add-subject-btn" class="w-full mt-2 bg-slate-800 text-white px-4 py-2 rounded-lg font-semibold hover:bg-slate-900 transition flex items-center justify-center gap-2">
                             <i data-lucide="plus" class="w-5 h-5"></i>
                             <span>Adicionar</span>
                         </button>
                     </div>
                </div>
            </div>

            <div id="view-revisoes" class="view">
                <h2 class="text-xl font-bold mb-4">Revisões Agendadas</h2>
                <div id="reviews-list" class="space-y-3">
                    </div>
            </div>

            <div id="view-salas" class="view">
                <h2 class="text-xl font-bold mb-4">Comunidade de Estudos</h2>
                <div id="study-room-list" class="space-y-2">
                    </div>
            </div>

            <div id="view-ranking" class="view">
                <h2 class="text-xl font-bold mb-4">Ranking Semanal 🏆</h2>
                <div class="bg-white rounded-lg shadow">
                    <ul id="ranking-list" class="divide-y divide-slate-200">
                       </ul>
                </div>
            </div>
            
            <div id="view-questoes" class="view">
                <h2 class="text-xl font-bold mb-4">Banco de Questões</h2>
                <div id="quiz-container" class="bg-slate-100 p-4 rounded-lg">
                    </div>
            </div>

             <div id="view-perfil" class="view">
                <div id="profile-container" class="hidden">
                    <h2 class="text-2xl font-bold text-center" id="welcome-message"></h2>
                    <p class="text-center text-slate-600 mt-2">Seus dados de estudo estão seguros.</p>
                    <button id="logout-btn" class="w-full mt-8 bg-red-500 text-white px-4 py-3 rounded-lg font-semibold hover:bg-red-600 transition flex items-center justify-center gap-2">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                        <span>Sair da Conta</span>
                    </button>
                </div>

                <div id="auth-container">
                    <div id="login-form-container">
                        <h2 class="text-2xl font-bold text-center">Acesse sua Conta</h2>
                        <form id="login-form" class="mt-6 space-y-4">
                            <input type="email" id="login-email" placeholder="Seu e-mail" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <input type="password" id="login-password" placeholder="Sua senha" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <button type="submit" class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">Entrar</button>
                        </form>
                        <p class="text-center text-sm mt-4">
                            Não tem uma conta? <a href="#" id="show-register-form" class="font-semibold text-blue-600 hover:underline">Cadastre-se</a>
                        </p>
                    </div>

                    <div id="register-form-container" class="hidden">
                        <h2 class="text-2xl font-bold text-center">Crie sua Conta</h2>
                        <form id="register-form" class="mt-6 space-y-4">
                            <input type="text" id="register-name" placeholder="Seu nome completo" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <input type="email" id="register-email" placeholder="Seu e-mail" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <input type="password" id="register-password" placeholder="Crie uma senha" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <button type="submit" class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">Criar Conta</button>
                        </form>
                        <p class="text-center text-sm mt-4">
                            Já tem uma conta? <a href="#" id="show-login-form" class="font-semibold text-blue-600 hover:underline">Faça login</a>
                        </p>
                    </div>
                </div>
            </div>

        </main>

        <nav class="fixed bottom-0 left-0 right-0 max-w-lg mx-auto bg-white border-t border-slate-200 flex justify-around p-2 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
            <button class="nav-item active flex flex-col items-center text-slate-500 p-2" data-view="cronometro">
                <i data-lucide="timer" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Cronômetro</span>
            </button>
            <button class="nav-item relative flex flex-col items-center text-slate-500 p-2" data-view="revisoes">
                <i data-lucide="repeat" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Revisões</span>
                <span id="review-badge" class="hidden absolute top-1 right-2 bg-red-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center"></span>
            </button>
            <button class="nav-item flex flex-col items-center text-slate-500 p-2" data-view="salas">
                <i data-lucide="users" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Salas</span>
            </button>
            <button class="nav-item flex flex-col items-center text-slate-500 p-2" data-view="ranking">
                <i data-lucide="bar-chart-3" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Ranking</span>
            </button>
            <button class="nav-item flex flex-col items-center text-slate-500 p-2" data-view="questoes">
                <i data-lucide="file-question" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Questões</span>
            </button>
             <button class="nav-item flex flex-col items-center text-slate-500 p-2" data-view="perfil">
                <i data-lucide="user-circle" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Perfil</span>
            </button>
        </nav>
    </div>

    <div id="summary-modal" class="modal-overlay">
        <div class="modal-content relative">
            <button id="close-summary-modal" class="absolute top-2 right-2 text-slate-500 hover:text-slate-800">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 id="summary-modal-title" class="text-2xl font-bold text-blue-700 mb-4"></h2>
            <div id="summary-modal-body" class="summary-content"></div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDqHXjI3lTXMgRWItxaP7An-JZe04YQ-Sg",
          authDomain: "gfconcursos-app.firebaseapp.com",
          projectId: "gfconcursos-app",
          storageBucket: "gfconcursos-app.firebasestorage.app",
          messagingSenderId: "615439428502",
          appId: "1:615439428502:web:b399549c3969e052098bb7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            const appState = {
                subjects: [],
                currentUser: null,
                studyCycle: { goalSeconds: 0, completedSeconds: 0 },
                reviews: [],
                timer: {
                    instance: null,
                    startTime: 0,
                    accumulated: 0,
                    isRunning: false,
                    currentItem: null,
                },
                selectedItem: null,
                quiz: {
                    active: false,
                    subjectName: null,
                    topicName: null,
                    questions: [],
                    currentIndex: 0,
                }
            };

            // --- Elementos do DOM ---
            const timerDisplay = document.getElementById('timer-display');
            const startPauseBtn = document.getElementById('start-pause-btn');
            const stopBtn = document.getElementById('stop-btn');
            const newSubjectSelect = document.getElementById('new-subject-select');
            const customSubjectInput = document.getElementById('custom-subject-input');
            const addSubjectBtn = document.getElementById('add-subject-btn');
            const addSubjectContainer = document.getElementById('add-subject-container');
            const subjectsList = document.getElementById('subjects-list');
            const currentSubjectDisplay = document.getElementById('current-subject-display');
            const navItems = document.querySelectorAll('.nav-item');
            const views = document.querySelectorAll('.view');
            const quizContainer = document.getElementById('quiz-container');
            const summaryModal = document.getElementById('summary-modal');
            const summaryModalTitle = document.getElementById('summary-modal-title');
            const summaryModalBody = document.getElementById('summary-modal-body');
            const closeSummaryModalBtn = document.getElementById('close-summary-modal');
            const headerSubtitle = document.getElementById('header-subtitle');
            
            // Ciclo de Estudo
            const cycleGoalInput = document.getElementById('cycle-goal-input');
            const setCycleGoalBtn = document.getElementById('set-cycle-goal-btn');
            const cycleProgress = document.getElementById('cycle-progress');
            const cycleProgressText = document.getElementById('cycle-progress-text');
            const cycleProgressBarInner = document.getElementById('cycle-progress-bar-inner');
            const cycleProgressPercentage = document.getElementById('cycle-progress-percentage');
            const cycleCompletedBox = document.getElementById('cycle-completed-box');
            
            // Revisões
            const reviewsList = document.getElementById('reviews-list');
            const reviewBadge = document.getElementById('review-badge');
            
            // Autenticação
            const profileContainer = document.getElementById('profile-container');
            const authContainer = document.getElementById('auth-container');
            const loginFormContainer = document.getElementById('login-form-container');
            const registerFormContainer = document.getElementById('register-form-container');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const showRegisterBtn = document.getElementById('show-register-form');
            const showLoginBtn = document.getElementById('show-login-form');
            const logoutBtn = document.getElementById('logout-btn');
            const welcomeMessage = document.getElementById('welcome-message');
            const studyRoomList = document.getElementById('study-room-list');

            // --- Funções de Lógica ---
            function formatTime(seconds) {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = Math.floor(seconds % 60);
                if (h > 0) {
                    return `${h.toString()}h ${m.toString().padStart(2, '0')}m`;
                }
                return `${m.toString()}m ${s.toString().padStart(2, '0')}s`;
            }
            
             function formatTimeHMS(seconds) {
                const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
                const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                const s = Math.floor(seconds % 60).toString().padStart(2, '0');
                return `${h}:${m}:${s}`;
            }

            function getDbKey(email) {
                return `gfconcursos_state_${email}`;
            }
            
            function saveState() {
                if (appState.currentUser) {
                    localStorage.setItem(getDbKey(appState.currentUser.email), JSON.stringify({ 
                        subjects: appState.subjects,
                        studyCycle: appState.studyCycle,
                        reviews: appState.reviews
                    }));
                }
            }

            function loadState() {
                if (appState.currentUser) {
                    const savedState = localStorage.getItem(getDbKey(appState.currentUser.email));
                    const data = savedState ? JSON.parse(savedState) : {};
                    appState.subjects = data.subjects || [];
                    appState.studyCycle = data.studyCycle || { goalSeconds: 0, completedSeconds: 0 };
                    appState.reviews = data.reviews || [];
                } else {
                    appState.subjects = [];
                    appState.studyCycle = { goalSeconds: 0, completedSeconds: 0 };
                    appState.reviews = [];
                }
                renderStudyCycle();
            }
            
            function renderSubjects() {
                subjectsList.innerHTML = '';
                if (!appState.currentUser) {
                     subjectsList.innerHTML = `<li class="p-4 text-center text-slate-500">Faça login para ver e adicionar suas disciplinas.</li>`;
                     addSubjectContainer.classList.add('hidden');
                     document.getElementById('study-cycle-container').classList.add('hidden');
                     return;
                }
                
                addSubjectContainer.classList.remove('hidden');
                document.getElementById('study-cycle-container').classList.remove('hidden');

                if (appState.subjects.length === 0) {
                    subjectsList.innerHTML = `<li class="p-4 text-center text-slate-500">Adicione sua primeira disciplina.</li>`;
                    return;
                }
                
                appState.subjects.forEach(subject => {
                    const isSelectedSubject = appState.selectedItem?.type === 'subject' && appState.selectedItem.subjectId === subject.id;
                    const li = document.createElement('li');
                    li.className = 'subject-item';
                    li.dataset.subjectId = subject.id;
                    li.dataset.subjectName = subject.name;

                    const topicsHTML = subject.topics.map(topic => {
                        const isSelectedTopic = appState.selectedItem?.type === 'topic' && appState.selectedItem.topicId === topic.id;
                        return `
                            <li class="flex justify-between items-center p-3 transition ${isSelectedTopic ? 'bg-blue-50' : 'hover:bg-slate-50'}">
                                <div class="cursor-pointer flex-grow" data-select-topic-id="${topic.id}" data-parent-id="${subject.id}">
                                    <span class="font-medium text-sm">${topic.name}</span>
                                    <span class="block text-xs text-slate-500">Total: ${formatTimeHMS(topic.totalTime)}</span>
                                </div>
                                <div class="flex items-center space-x-1 pl-1">
                                    <button data-practice-topic-id="${topic.id}" data-parent-id="${subject.id}" class="text-blue-600 hover:text-blue-800 p-1 rounded-full flex items-center text-xs font-semibold"><i data-lucide="file-question" class="w-3 h-3 mr-1"></i> Praticar</button>
                                    <button data-delete-topic-id="${topic.id}" data-parent-id="${subject.id}" class="text-red-500 hover:text-red-700 p-1 rounded-full"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                                </div>
                            </li>
                        `;
                    }).join('');

                    li.innerHTML = `
                        <div class="p-4 flex justify-between items-center transition cursor-pointer ${isSelectedSubject ? 'bg-blue-100' : 'hover:bg-slate-50'}">
                            <div class="flex-grow" data-select-subject-id="${subject.id}" data-toggle-topics-id="${subject.id}">
                                <span class="font-semibold">${subject.name}</span>
                                <span class="block text-sm text-slate-500">Total: ${formatTimeHMS(subject.totalTime)}</span>
                            </div>
                            <div class="flex items-center space-x-2 pl-2">
                               <button data-summary-subject-name="${subject.name}" class="text-indigo-600 hover:text-indigo-800 p-1 rounded-full" title="Ver Resumo"><i data-lucide="book-open" class="w-4 h-4"></i></button>
                               <button data-practice-subject-id="${subject.id}" class="text-blue-600 hover:text-blue-800 p-1 rounded-full" title="Praticar Tudo"><i data-lucide="library" class="w-4 h-4"></i></button>
                               <button data-delete-subject-id="${subject.id}" class="text-red-500 hover:text-red-700 p-1 rounded-full" title="Excluir Disciplina"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                               <i data-lucide="chevron-down" class="w-5 h-5 transition-transform chevron" data-toggle-topics-id="${subject.id}"></i>
                            </div>
                        </div>
                        <div class="topics-container pl-4 border-l-2 border-slate-200 ml-4">
                            <ul class="topic-list divide-y divide-slate-100">${topicsHTML}</ul>
                            <div class="p-2 flex gap-2">
                                <input type="text" data-topic-input-id="${subject.id}" placeholder="Novo assunto" class="flex-grow w-full px-2 py-1 border border-slate-300 rounded-md text-sm">
                                <button data-add-topic-id="${subject.id}" class="bg-slate-600 text-white px-3 py-1 text-sm rounded-md hover:bg-slate-700">Add</button>
                            </div>
                        </div>
                    `;
                    subjectsList.appendChild(li);
                });
                lucide.createIcons();
                updateTimerControls();
            }

            function addSubject() {
                if (!appState.currentUser) {
                    alert("Você precisa estar logado para adicionar disciplinas.");
                    return;
                }
                const customName = customSubjectInput.value.trim();
                const selectName = newSubjectSelect.value;
                const name = customName || selectName;

                if (name && !appState.subjects.some(s => s.name === name)) {
                    let topics = [];
                    if (!customName && selectName) {
                        const normalizedName = normalizeString(selectName);
                        const topicsData = questionsDB[normalizedName];
                        if (topicsData) {
                            const topicNames = new Set(topicsData.map(topicObj => topicObj.topic));
                            topics = [...topicNames].map(topicName => ({ id: Date.now() + Math.random(), name: topicName, totalTime: 0, studyLog: [] }));
                        }
                    }
                    appState.subjects.push({ id: Date.now(), name, totalTime: 0, topics });
                    customSubjectInput.value = '';
                    newSubjectSelect.value = '';
                    saveState();
                    renderSubjects();
                } else if (name) {
                    alert('Essa disciplina já foi adicionada.');
                }
            }

            function addTopic(subjectId, topicName) {
                const subject = appState.subjects.find(s => s.id === subjectId);
                if (subject && topicName) {
                    subject.topics.push({ id: Date.now(), name: topicName, totalTime: 0, studyLog: [] });
                    saveState();
                    renderSubjects();
                    document.querySelector(`[data-subject-id='${subjectId}']`)?.classList.add('is-expanded');
                }
            }
            
            function deleteSubject(id) {
                if (appState.timer.isRunning && appState.timer.currentItem?.subjectId === id) stopTimer();
                if (appState.selectedItem?.subjectId === id) appState.selectedItem = null;
                appState.subjects = appState.subjects.filter(s => s.id !== id);
                // Also delete related reviews
                appState.reviews = appState.reviews.filter(r => r.subjectId !== id);
                saveState();
                renderSubjects();
                updateCurrentSubjectDisplay();
            }

            function deleteTopic(subjectId, topicId) {
                if (appState.timer.isRunning && appState.timer.currentItem?.topicId === topicId) stopTimer();
                if (appState.selectedItem?.topicId === topicId) appState.selectedItem = null;
                const subject = appState.subjects.find(s => s.id === subjectId);
                if(subject) {
                    subject.topics = subject.topics.filter(t => t.id !== topicId);
                    // Also delete related reviews
                    appState.reviews = appState.reviews.filter(r => r.topicId !== topicId);
                    saveState();
                    renderSubjects();
                    updateCurrentSubjectDisplay();
                    document.querySelector(`[data-subject-id='${subjectId}']`)?.classList.add('is-expanded');
                }
            }
            
            function selectItem(type, subjectId, topicId = null) {
                 if (!appState.currentUser) {
                     alert("Faça login para selecionar uma disciplina.");
                     return;
                 }
                if (appState.timer.isRunning) {
                     const current = appState.timer.currentItem;
                     if(current.type !== type || current.subjectId !== subjectId || current.topicId !== topicId) {
                         alert('Pare o cronômetro atual antes de selecionar outro item.');
                         return;
                     }
                }
                appState.selectedItem = { type, subjectId, topicId };
                updateCurrentSubjectDisplay();
                renderSubjects();
            }
            
            function updateCurrentSubjectDisplay() {
                 if (!appState.selectedItem) {
                    currentSubjectDisplay.innerHTML = 'Nenhuma disciplina selecionada';
                    return;
                }
                const { type, subjectId, topicId } = appState.selectedItem;
                const subject = appState.subjects.find(s => s.id === subjectId);
                if (!subject) {
                    appState.selectedItem = null;
                    updateCurrentSubjectDisplay();
                    return;
                }
                if (type === 'topic') {
                    const topic = subject.topics.find(t => t.id === topicId);
                    if (topic) {
                        currentSubjectDisplay.innerHTML = `Estudando: <span class="font-bold">${subject.name}</span><br/><span class="text-sm">${topic.name}</span>`;
                    } else {
                        appState.selectedItem = null;
                        updateCurrentSubjectDisplay();
                    }
                } else {
                    currentSubjectDisplay.innerHTML = `Estudando: <span class="font-bold">${subject.name}</span>`;
                }
            }

            function updateTimerControls() {
                const hasSelectionAndUser = appState.selectedItem && appState.currentUser;
                startPauseBtn.disabled = !hasSelectionAndUser;
                stopBtn.disabled = !appState.timer.isRunning && appState.timer.accumulated === 0;
            }
            
            // --- Lógica do Cronômetro ---
            function updateDisplay() {
                const elapsed = (Date.now() - appState.timer.startTime) / 1000;
                timerDisplay.textContent = formatTimeHMS(appState.timer.accumulated + elapsed);
            }

            function startTimer() {
                if (appState.timer.isRunning || !appState.selectedItem) return;
                appState.timer.currentItem = { ...appState.selectedItem };
                appState.timer.isRunning = true;
                appState.timer.startTime = Date.now();
                appState.timer.instance = setInterval(updateDisplay, 1000);
                startPauseBtn.innerHTML = `<i data-lucide="pause" class="w-5 h-5 mr-2"></i><span>Pausar</span>`;
                lucide.createIcons();
                stopBtn.disabled = false;
            }

            function pauseTimer() {
                if (!appState.timer.isRunning) return;
                appState.timer.isRunning = false;
                clearInterval(appState.timer.instance);
                appState.timer.accumulated += (Date.now() - appState.timer.startTime) / 1000;
                startPauseBtn.innerHTML = `<i data-lucide="play" class="w-5 h-5 mr-2"></i><span>Continuar</span>`;
                lucide.createIcons();
            }
            
            function stopTimer() {
                if (!appState.timer.currentItem) return;
                let finalTime = appState.timer.accumulated;
                if(appState.timer.isRunning) finalTime += (Date.now() - appState.timer.startTime) / 1000;
                
                const { type, subjectId, topicId } = appState.timer.currentItem;
                const subject = appState.subjects.find(s => s.id === subjectId);
                if (subject) {
                    subject.totalTime += finalTime;
                    // Add to study cycle
                    appState.studyCycle.completedSeconds += finalTime;
                    
                    if (type === 'topic') {
                        const topic = subject.topics.find(t => t.id === topicId);
                        if (topic) {
                           topic.totalTime += finalTime;
                           scheduleReviews(subject, topic);
                        }
                    }
                }
                
                appState.timer.isRunning = false;
                clearInterval(appState.timer.instance);
                appState.timer.accumulated = 0;
                appState.timer.currentItem = null;
                
                timerDisplay.textContent = formatTimeHMS(0);
                startPauseBtn.innerHTML = `<i data-lucide="play" class="w-5 h-5 mr-2"></i><span>Iniciar</span>`;
                lucide.createIcons();
                saveState();
                renderSubjects();
                renderStudyCycle();
                updateReviewNotification();
            }
            
            // --- Lógica do Ciclo de Estudo e Revisões ---
            function setStudyCycleGoal() {
                const hours = parseFloat(cycleGoalInput.value);
                if (hours && hours > 0) {
                    appState.studyCycle.goalSeconds = hours * 3600;
                    appState.studyCycle.completedSeconds = 0; // Reset progress
                    saveState();
                    renderStudyCycle();
                } else {
                    alert("Por favor, insira um número de horas válido.");
                }
            }

            function renderStudyCycle() {
                if (!appState.currentUser || appState.studyCycle.goalSeconds === 0) {
                    cycleProgress.classList.add('hidden');
                    return;
                }
                cycleProgress.classList.remove('hidden');

                const { goalSeconds, completedSeconds } = appState.studyCycle;
                const percentage = Math.min(100, (completedSeconds / goalSeconds) * 100);
                
                cycleProgressBarInner.style.width = `${percentage}%`;
                cycleProgressPercentage.textContent = `${Math.floor(percentage)}%`;
                
                const completedHours = (completedSeconds / 3600).toFixed(1);
                const goalHours = (goalSeconds / 3600).toFixed(1);
                cycleProgressText.textContent = `${formatTime(completedSeconds)} / ${goalHours}h`;
                
                cycleCompletedBox.classList.toggle('hidden', percentage < 100);
            }

            function scheduleReviews(subject, topic) {
                const today = new Date().toISOString().split('T')[0];
                const reviewPeriods = [1, 7, 21, 30];

                const hasExistingReviewToday = appState.reviews.some(r => 
                    r.topicId === topic.id && r.studyDate === today
                );
                
                if (!hasExistingReviewToday) {
                    reviewPeriods.forEach(days => {
                        const studyDate = new Date();
                        const dueDate = new Date();
                        dueDate.setDate(studyDate.getDate() + days);
                        
                        const newReview = {
                            id: Date.now() + Math.random(),
                            subjectId: subject.id,
                            topicId: topic.id,
                            subjectName: subject.name,
                            topicName: topic.name,
                            studyDate: today,
                            days,
                            dueDate: dueDate.toISOString().split('T')[0],
                            isCompleted: false
                        };
                        appState.reviews.push(newReview);
                    });
                }
            }
            
            function renderReviews() {
                if (!appState.currentUser) {
                    reviewsList.innerHTML = `<li class="p-4 text-center text-slate-500">Faça login para ver suas revisões.</li>`;
                    return;
                }

                const pendingReviews = appState.reviews
                    .filter(r => !r.isCompleted)
                    .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                
                if (pendingReviews.length === 0) {
                     reviewsList.innerHTML = `<div class="p-4 text-center bg-green-100 text-green-700 rounded-lg"><p class="font-semibold">Nenhuma revisão pendente!</p><p class="text-sm">Quando você estudar um assunto, as revisões aparecerão aqui.</p></div>`;
                     return;
                }

                const today = new Date();
                today.setHours(0,0,0,0);

                reviewsList.innerHTML = pendingReviews.map(review => {
                    const dueDate = new Date(review.dueDate + 'T00:00:00');
                    const diffTime = dueDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    let dateInfo;
                    if (diffDays < 0) {
                        dateInfo = `<span class="font-bold text-red-600">Atrasada ${Math.abs(diffDays)}d</span>`;
                    } else if (diffDays === 0) {
                        dateInfo = `<span class="font-bold text-yellow-600">Para Hoje</span>`;
                    } else {
                        dateInfo = `<span>Em ${diffDays}d</span>`;
                    }

                    return `
                        <div class="bg-white p-3 rounded-lg shadow-sm flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-slate-800">${review.topicName}</p>
                                <p class="text-sm text-slate-500">${review.subjectName} - Rev. de ${review.days} dias</p>
                                <p class="text-xs text-slate-400 mt-1">Vence em: ${new Date(review.dueDate + 'T00:00:00').toLocaleDateString('pt-BR')} (${dateInfo})</p>
                            </div>
                            <button data-review-id="${review.id}" class="complete-review-btn bg-green-500 text-white px-3 py-1 rounded-md font-semibold text-sm hover:bg-green-600 transition">Concluir</button>
                        </div>
                    `;
                }).join('');
            }

            function completeReview(reviewId) {
                const minutesStr = prompt("Quantos minutos você gastou nesta revisão?");
                if (minutesStr === null) return; // User cancelled

                const minutes = parseInt(minutesStr, 10);
                if (isNaN(minutes) || minutes < 0) {
                    alert("Por favor, insira um número válido de minutos.");
                    return;
                }

                const review = appState.reviews.find(r => r.id === reviewId);
                if (review) {
                    review.isCompleted = true;
                    appState.studyCycle.completedSeconds += minutes * 60;
                    saveState();
                    renderReviews();
                    renderStudyCycle();
                    updateReviewNotification();
                }
            }
            
            function updateReviewNotification() {
                if (!appState.currentUser) {
                    reviewBadge.classList.add('hidden');
                    return;
                }
                const pendingCount = appState.reviews.filter(r => !r.isCompleted).length;
                if (pendingCount > 0) {
                    reviewBadge.textContent = pendingCount;
                    reviewBadge.classList.remove('hidden');
                } else {
                    reviewBadge.classList.add('hidden');
                }
            }

            // --- Navegação ---
            function switchView(viewName) {
                views.forEach(view => view.classList.toggle('active', view.id === `view-${viewName}`));
                navItems.forEach(item => {
                    const icon = item.querySelector('i');
                    item.classList.toggle('active', item.dataset.view === viewName);
                });
                lucide.createIcons();
                if (viewName === 'questoes') renderQuizView();
                if (viewName === 'salas') renderStudyRoom();
                if (viewName === 'ranking') renderRanking();
                if (viewName === 'revisoes') renderReviews();
            }

            // --- Gerenciamento de Usuários ---
            function getUsers() {
                return JSON.parse(localStorage.getItem('gfconcursos_users')) || [];
            }

            function saveUsers(users) {
                localStorage.setItem('gfconcursos_users', JSON.stringify(users));
            }

            function registerUser(name, email, password) {
                const users = getUsers();
                if (users.some(user => user.email === email)) {
                    alert('Este e-mail já está cadastrado.');
                    return;
                }
                const newUser = { name, email, password, isOnline: false };
                users.push(newUser);
                saveUsers(users);
                alert('Cadastro realizado com sucesso! Faça o login.');
                toggleAuthForms();
            }

            function loginUser(email, password) {
                const users = getUsers();
                const user = users.find(u => u.email === email);

                if (user && user.password === password) {
                    user.isOnline = true;
                    saveUsers(users);
                    localStorage.setItem('gfconcursos_currentUser', JSON.stringify(user));
                    appState.currentUser = user;
                    updateUIForLogin();
                } else {
                    alert('E-mail ou senha incorretos.');
                }
            }

            function logoutUser() {
                const users = getUsers();
                const user = users.find(u => u.email === appState.currentUser.email);
                if (user) {
                    user.isOnline = false;
                    saveUsers(users);
                }
                localStorage.removeItem('gfconcursos_currentUser');
                appState.currentUser = null;
                if(appState.timer.isRunning) stopTimer();
                loadState(); // Clears app state
                updateCurrentSubjectDisplay();
                updateUIForLogout();
                updateReviewNotification();
                switchView('perfil');
            }

            function updateUIForLogin() {
                profileContainer.classList.remove('hidden');
                authContainer.classList.add('hidden');
                welcomeMessage.textContent = `Olá, ${appState.currentUser.name.split(' ')[0]}!`;
                headerSubtitle.textContent = `Bem-vindo(a) de volta!`;
                loadState();
                renderSubjects();
                updateTimerControls();
                updateReviewNotification();
                switchView('cronometro');
            }
            
            function updateUIForLogout() {
                profileContainer.classList.add('hidden');
                authContainer.classList.remove('hidden');
                headerSubtitle.textContent = 'Seu parceiro rumo à aprovação';
                renderSubjects();
                updateTimerControls();
                renderStudyCycle();
            }
            
            function checkLoggedInUser() {
                const storedUser = localStorage.getItem('gfconcursos_currentUser');
                if (storedUser) {
                    appState.currentUser = JSON.parse(storedUser);
                    const users = getUsers();
                    const userInDB = users.find(u => u.email === appState.currentUser.email);
                    if (userInDB && !userInDB.isOnline) {
                        userInDB.isOnline = true;
                        saveUsers(users);
                    }
                    updateUIForLogin();
                } else {
                    updateUIForLogout();
                }
            }

            function toggleAuthForms() {
                loginFormContainer.classList.toggle('hidden');
                registerFormContainer.classList.toggle('hidden');
            }

            function renderStudyRoom() {
                const users = getUsers();
                studyRoomList.innerHTML = users.map(user => {
                    const isOnline = user.isOnline;
                    const statusClass = isOnline ? 'text-green-600' : 'text-slate-400';
                    const pulseClass = isOnline ? 'animate-pulse' : '';
                    const statusText = isOnline ? 'Online' : 'Offline';

                    return `
                    <div class="bg-white p-3 rounded-lg flex items-center justify-between shadow-sm">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-500 mr-3">${user.name.charAt(0)}</div>
                            <div>
                                <p class="font-semibold">${user.name}</p>
                                <p class="text-sm text-slate-500">${user.email}</p>
                            </div>
                        </div>
                        <div class="flex items-center ${statusClass}">
                            <div class="w-2 h-2 bg-current rounded-full mr-2 ${pulseClass}"></div>
                            <span class="text-sm font-medium">${statusText}</span>
                        </div>
                    </div>
                    `;
                }).join('');
            }

            function renderRanking() {
                const users = getUsers();
                const rankingData = users.map(user => {
                    const userState = localStorage.getItem(getDbKey(user.email));
                    let totalTime = 0;
                    if (userState) {
                        const parsedState = JSON.parse(userState);
                        const cycleTime = parsedState.studyCycle?.completedSeconds || 0;
                        totalTime = cycleTime;
                    }
                    return { name: user.name, email: user.email, totalTime };
                }).sort((a, b) => b.totalTime - a.totalTime);

                const rankingList = document.getElementById('ranking-list');
                rankingList.innerHTML = ''; 

                if (rankingData.length === 0) {
                    rankingList.innerHTML = `<li class="p-4 text-center text-slate-500">Nenhum usuário no ranking. Cadastre-se e comece a estudar!</li>`;
                    return;
                }

                rankingData.forEach((user, index) => {
                    let rankDisplay;
                    switch(index) {
                        case 0: rankDisplay = '🥇'; break;
                        case 1: rankDisplay = '🥈'; break;
                        case 2: rankDisplay = '🥉'; break;
                        default: rankDisplay = `${index + 1}`;
                    }

                    const isCurrentUser = appState.currentUser && appState.currentUser.email === user.email;
                    const highlightClass = isCurrentUser ? 'bg-blue-50' : '';

                    const li = document.createElement('li');
                    li.className = `p-4 flex items-center ${highlightClass}`;
                    li.innerHTML = `
                        <span class="text-xl font-bold w-10 text-center">${rankDisplay}</span>
                        <p class="flex-grow font-semibold">${user.name}</p>
                        <p class="text-slate-600 font-medium">${formatTime(user.totalTime)}</p>
                    `;
                    rankingList.appendChild(li);
                });
            }

             const summariesDB = {
                 'lingua portuguesa': `
                     <h3>Visão Geral da Banca FGV</h3>
                     <p>Disciplina de grande peso, que valoriza a interpretação e a aplicação prática da gramática. A banca testa o candidato 'cansado', com textos longos e complexos para verificar a atenção e a resistência. O foco é entender como a gramática constrói o sentido do texto.</p>
                     <h4>Interpretação de Textos</h4>
                     <p><strong>Foco:</strong> Compreender informações centrais, inferir sentidos, identificar a tese do autor e reconhecer a tipologia textual. <strong>Dica:</strong> Primeiro, leia as perguntas para saber o que procurar no texto. Desconfie de alternativas que generalizam ('sempre', 'nunca') ou extrapolam o que foi dito.</p>
                     <h4>Concordância Verbal e Nominal</h4>
                     <p><strong>Foco:</strong> Relação entre sujeito e verbo, e substantivo e seus determinantes. Cuidado com casos de sujeito composto (especialmente posposto ao verbo), sujeito oracional e verbos impessoais como 'haver' e 'fazer' indicando tempo.</p>
                     <h4>Regência Verbal e Nominal</h4>
                     <p><strong>Foco:</strong> Entender a preposição exigida. Verbos que mudam de sentido com a mudança de regência (aspirar, assistir, visar) são sempre cobrados. Crie uma lista com os mais traiçoeiros.</p>
                     <h4>Pontuação</h4>
                     <p><strong>Foco:</strong> Uso da vírgula é o principal. Estude como isolar orações adjetivas explicativas, adjuntos adverbiais deslocados, apostos e vocativos. A FGV avalia a pontuação como elemento que altera a estrutura e o sentido.</p>
                 `,
                 'raciocinio logico matematico': `
                     <h3>Visão Geral da Banca FGV</h3>
                     <p>Mais do que decorar fórmulas, a FGV exige que você traduza enunciados em português para a linguagem lógica formal. A interpretação correta do problema é 80% da questão.</p>
                     <h4>Estruturas Lógicas e Lógica Proposicional</h4>
                     <p><strong>Foco:</strong> Tabela-verdade, conectivos, negações e equivalências. <strong>Dica:</strong> A equivalência da condicional ('Se P, então Q' ⇔ 'Se não Q, então não P' ⇔ 'Não P ou Q') é o item mais cobrado na história da banca. Domine-a!</p>
                     <h4>Lógica de Argumentação e Diagramas Lógicos</h4>
                     <p><strong>Foco:</strong> Validade de argumentos e uso de diagramas de Venn (diagramas lógicos) para resolver problemas com quantificadores como 'todo', 'algum' e 'nenhum'. Treine visualizar os conjuntos e suas intersecções.</p>
                     <h4>Análise Combinatória e Probabilidade</h4>
                     <p><strong>Foco:</strong> Saber quando usar arranjo, combinação ou permutação. A chave é se perguntar: 'A ordem dos elementos importa?'. Em probabilidade, o cálculo de eventos simples (casos favoráveis / casos possíveis) é o mais comum.</p>
                 `,
                 'historia e geografia de rondonia': `
                     <h3>Visão Geral</h3>
                     <p>Exige conhecimento aprofundado sobre a formação e as características do estado. A banca pode usar fotos, mapas antigos ou trechos de jornais para contextualizar as questões.</p>
                     <h4>Processo de Colonização e Ciclos Econômicos</h4>
                     <p><strong>Foco:</strong> Entender os ciclos da borracha (e o papel dos 'soldados da borracha'), da cassiterita e da agropecuária. A construção da Estrada de Ferro Madeira-Mamoré é um ponto central e deve ser estudada em detalhes, incluindo suas motivações e consequências.</p>
                     <h4>Criação do Estado</h4>
                     <p><strong>Foco:</strong> Memorize o processo: criação do Território Federal do Guaporé (1943), mudança para Território de Rondônia (1956) e elevação a Estado (1981). A FGV pode contextualizar com os presidentes da época (Vargas, JK, Figueiredo).</p>
                     <h4>Aspectos Físicos</h4>
                     <p><strong>Foco:</strong> Conhecer o relevo (predomínio de planícies), a importância dos rios da bacia amazônica (Madeira, Guaporé, Mamoré) e as características do clima equatorial (quente e úmido).</p>
                 `,
                 'direito constitucional': `
                     <h3>Visão Geral da Banca FGV</h3>
                     <p>A banca foca na literalidade da Constituição, mas também cobra a interpretação consolidada do STF (jurisprudência sumulada). Não basta ler o artigo, é preciso entender como ele é aplicado.</p>
                     <h4>Direitos e Garantias Fundamentais (Art. 5º)</h4>
                     <p><strong>Foco:</strong> Memorização dos incisos. <strong>Dica:</strong> Agrupe os incisos por tema (direitos individuais, de associação, remédios constitucionais) para facilitar. Entenda a aplicabilidade e os requisitos de cada remédio (Habeas Corpus, Mandado de Segurança, etc.).</p>
                     <h4>Administração Pública (Art. 37 a 41)</h4>
                     <p><strong>Foco:</strong> Princípios da Administração (L.I.M.P.E.), regras de concurso, estabilidade e acumulação de cargos. A FGV adora criar casos práticos sobre acumulação.</p>
                     <h4>Organização do Estado</h4>
                     <p><strong>Foco:</strong> Repartição de competências (Arts. 21 a 24). É um tema complexo. <strong>Dica:</strong> Crie uma tabela para visualizar o que é competência privativa da União, concorrente entre União e Estados, e comum a todos.</p>
                 `,
                 'direito administrativo': `
                     <h3>Visão Geral da Banca FGV</h3>
                     <p>Matéria extremamente relevante. A FGV ama criar 'historinhas' e casos práticos para testar a aplicação da teoria. Ao estudar, imagine-se como um servidor público resolvendo o problema.</p>
                     <h4>Atos Administrativos</h4>
                     <p><strong>Foco:</strong> Atributos (presunção de legitimidade, autoexecutoriedade, tipicidade, imperatividade) e os elementos de validade. <strong>Dica:</strong> Decore o mnemônico <strong>COFIFOMOB</strong> (Competência, Finalidade, Forma, Motivo, Objeto).</p>
                     <h4>Poderes da Administração</h4>
                     <p><strong>Foco:</strong> Diferenciar os poderes, especialmente o poder de polícia (suas fases e limites) do poder disciplinar e hierárquico. Entenda a diferença entre uso e abuso de poder.</p>
                     <h4>Licitações e Contratos (Lei 14.133/2021)</h4>
                     <p><strong>Foco:</strong> Conhecer as novas modalidades (diálogo competitivo), os princípios e os critérios de julgamento. Não precisa decorar todos os prazos, mas entenda o fluxo geral do processo licitatório.</p>
                     <h4>Improbidade Administrativa</h4>
                     <p><strong>Foco:</strong> As atualizações recentes são cruciais. A principal mudança é a exigência de <strong>dolo específico</strong> para a caracterização do ato ímprobo. Atos culposos não são mais punidos por esta lei.</p>
                 `,
                 'legislacao especifica': `
                     <h3>Visão Geral</h3>
                     <p>Aqui, o conhecimento literal das normas é crucial. A banca costuma trocar uma única palavra para tornar a alternativa incorreta. O método de estudo é a repetição.</p>
                     <h4>Constituição do Estado de Rondônia</h4>
                     <p><strong>Foco:</strong> Dê atenção especial às competências da Assembleia Legislativa (Art. 34) e do Governador do Estado (Art. 65). Leia também os artigos sobre os servidores públicos estaduais.</p>
                     <h4>Regimento Interno da ALE-RO</h4>
                     <p><strong>Foco:</strong> É um conteúdo denso. Priorize a composição da Mesa Diretora, o funcionamento das sessões (tipos, quóruns) e o processo de tramitação das proposições (leis, resoluções, etc.). <strong>Dica:</strong> Crie flashcards com os prazos e números importantes (quórum de votação, número de deputados nas comissões, etc.).</p>
                 `
            };
            
            function showSummaryModal(subjectName) {
                const normalizedName = normalizeString(subjectName);
                const summaryHTML = summariesDB[normalizedName];

                if (summaryHTML) {
                    summaryModalTitle.textContent = subjectName;
                    summaryModalBody.innerHTML = summaryHTML;
                    summaryModal.classList.add('is-open');
                } else {
                    alert('Nenhum resumo encontrado para esta disciplina.');
                }
            }

            function hideSummaryModal() {
                summaryModal.classList.remove('is-open');
            }

            // BANCO DE DADOS DE QUESTÕES EXPANDIDO
            const questionsDB = {
                'lingua portuguesa': [
                    { topic: 'Interpretação de Textos', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Considerando o trecho "A persistência é o caminho do êxito", de Charles Chaplin, julgue a afirmativa.', statement: 'O autor sugere que o sucesso é um evento instantâneo, não dependendo de esforço contínuo.', answer: 'errado' },
                        { banca: 'FGV', year: '2022', prompt: 'Em "O homem, que é um ser racional, muitas vezes age por impulso."', statement: 'A informação de que o homem é um ser racional é apresentada como uma verdade universal e indispensável para o sentido da frase.', answer: 'errado' },
                        { banca: 'FGV', year: '2024', prompt: 'No fragmento "Embora chovesse, fomos à praia."', statement: 'A oração "Embora chovesse" expressa uma ideia de concessão em relação à oração principal.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Texto: "A tecnologia aproxima os distantes e distancia os próximos."', statement: 'O texto constrói seu sentido a partir de uma relação de paradoxo.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'A partir da leitura de um editorial de jornal que critica a burocracia estatal.', statement: 'É correto inferir que a principal função desse gênero textual é apresentar uma opinião sobre um tema relevante.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'No ditado popular "Água mole em pedra dura, tanto bate até que fura".', statement: 'A ideia central do provérbio é a valorização da insistência para superar obstáculos.', answer: 'certo' },
                    ]},
                    { topic: 'Concordância Verbal e Nominal', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Analise a concordância na frase a seguir.', statement: 'Na frase "Faz muitos anos que não vejo meus amigos", o verbo "Fazer" está empregado corretamente, indicando tempo decorrido.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Julgue a correção da frase.', statement: 'A frase "Houveram muitos problemas na reunião" está gramaticalmente correta.', answer: 'errado' },
                        { banca: 'FGV', year: '2024', prompt: 'Julgue a concordância na expressão "meio-dia e meia".', statement: 'A palavra "meia" concorda com a palavra "hora", que está subentendida.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Sobre a frase "A maioria dos concurseiros sonha com a aprovação".', statement: 'O verbo "sonha" poderia ser flexionado no plural ("sonham"), concordando com "concurseiros", sem que houvesse erro gramatical.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Julgue a frase "É proibido entrada de estranhos".', statement: 'A concordância está correta, pois o sujeito "entrada" não está determinado por artigo.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Analise a frase "Segue anexo os documentos solicitados".', statement: 'A concordância nominal está incorreta; o correto seria "Seguem anexos os documentos solicitados".', answer: 'certo' },
                    ]},
                    { topic: 'Regência Verbal e Nominal', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Julgue a regência do verbo "assistir" na frase "O paciente assistiu o médico durante o procedimento".', statement: 'O verbo "assistir", no sentido de "ajudar", é transitivo direto, portanto a regência está correta.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Analise a frase "Eu aspiro o cargo de Técnico Legislativo".', statement: 'O verbo "aspirar", no sentido de "almejar", exige a preposição "a", sendo a forma correta: "Eu aspiro ao cargo...".', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Julgue a regência do verbo "implicar".', statement: 'Na frase "Estudar implica aprovação", o verbo "implicar" é transitivo direto, não exigindo a preposição "em".', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Analise a frase "O filme que assisti ontem foi excelente".', statement: 'A regência do verbo "assistir" (no sentido de ver) está incorreta, pois ele exige a preposição "a". O correto seria "ao qual assisti".', answer: 'certo' },
                    ]},
                    { topic: 'Crase', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'Sobre o uso do acento indicativo de crase, julgue o item.', statement: 'Na frase "O pesquisador se referiu àquelas teorias ultrapassadas", o uso da crase é facultativo.', answer: 'errado' },
                        { banca: 'FGV', year: '2023', prompt: 'Julgue a frase "Ele foi à França".', statement: 'O uso do acento indicativo de crase é obrigatório, pois o nome do país "França" admite o artigo "a".', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Analise a frase "A reunião começará às 14h".', statement: 'A crase é obrigatória antes de locuções adverbiais femininas que indicam hora.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Na frase "Ele escreve a lápis".', statement: 'O uso da crase antes de "lápis" é incorreto, pois "lápis" é uma palavra masculina.', answer: 'certo' },
                    ]},
                    { topic: 'Pontuação', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Julgue o uso da vírgula na seguinte frase: "O candidato, um jovem muito esforçado, passou no concurso."', statement: 'A vírgula foi utilizada para isolar um aposto explicativo.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Sobre a frase "Quando o edital foi publicado, todos começaram a estudar."', statement: 'A vírgula é utilizada para separar a oração subordinada adverbial deslocada da oração principal.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Na frase "O diretor solicitou aos servidores: dedicação, empenho e pontualidade."', statement: 'Os dois-pontos foram usados para introduzir uma enumeração.', answer: 'certo' },
                    ]},
                    { topic: 'Morfologia', questions: [
                         { banca: 'FGV', year: '2024', prompt: 'Na frase "O concurseiro que estuda, passa", analise a função da palavra "que".', statement: 'A palavra "que" é um pronome relativo, retomando o termo "concurseiro".', answer: 'certo' },
                         { banca: 'FGV', year: '2023', prompt: 'Em "Estuda-se muito para concursos", analise a partícula "se".', statement: 'A partícula "se" atua como índice de indeterminação do sujeito.', answer: 'certo' },
                         { banca: 'FGV', year: '2022', prompt: 'Na frase "Se você estudar, será aprovado".', statement: 'A palavra "Se" é uma conjunção subordinativa condicional.', answer: 'certo' },
                         { banca: 'FGV', year: '2024', prompt: 'Em "O edital é bastante claro".', statement: 'A palavra "bastante" funciona como um advérbio de intensidade, modificando o adjetivo "claro".', answer: 'certo' },
                    ]},
                    { topic: 'Semântica', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Julgue a relação de sentido entre as palavras "eminente" e "iminente".', statement: 'As palavras são parônimas, ou seja, possuem grafia e pronúncia parecidas, mas significados diferentes.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Na frase "O servidor deferiu o pedido".', statement: 'O verbo "deferir" é sinônimo de "conceder" ou "atender".', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Analise a frase "Ele acendeu a luz" e "Ele ascendeu na carreira".', statement: 'Os verbos "acender" e "ascender" são homônimos, pois possuem a mesma pronúncia, mas grafia e significados diferentes.', answer: 'certo' },
                    ]},
                    { topic: 'Figuras de Linguagem', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Na expressão "O plenário explodiu em aplausos".', statement: 'Ocorre uma hipérbole, que é a figura do exagero.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Na frase "Aquele servidor é uma raposa".', statement: 'Há uma metáfora, que consiste em uma comparação implícita.', answer: 'certo' },
                    ]}
                ],
                'raciocinio logico matematico': [
                    { topic: 'Estruturas Lógicas', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Julgue a equivalência lógica.', statement: 'A proposição "Se chove, então o chão molha" é logicamente equivalente a "Se o chão não molha, então não chove".', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Considere a proposição "João é servidor e Maria não é advogada".', statement: 'A negação dessa proposição é "João não é servidor ou Maria é advogada".', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'A proposição "O servidor é eficiente ou não é promovido".', statement: 'Sua equivalência lógica, utilizando a regra da condicional, é "Se o servidor não é eficiente, então não é promovido".', answer: 'certo' },
                    ]},
                    { topic: 'Lógica de Argumentação', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Considere o argumento: "Todos os rondonienses são brasileiros. João é rondoniense. Logo, João é brasileiro."', statement: 'Este argumento é um exemplo de silogismo válido.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Premissas: 1. Se o processo é urgente, o analista trabalha. 2. O analista não trabalha.', statement: 'A conclusão lógica que se pode extrair é que "o processo não é urgente".', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Premissas: 1. Ou Ana estuda, ou Bia viaja. 2. Ana não estuda.', statement: 'A conclusão válida do argumento é que "Bia viaja".', answer: 'certo' },
                    ]},
                    { topic: 'Diagramas Lógicos', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Julgue a representação por diagramas de Venn.', statement: 'A intersecção dos conjuntos "Servidores Públicos" e "Advogados" representa os servidores públicos que também são advogados.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Sabe-se que "Algum servidor é feliz" e "Todo servidor é competente".', statement: 'A partir dessas premissas, é correto concluir que "Algum competente é feliz".', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Em uma repartição, todo analista é formado em Direito. Se Carlos não é formado em Direito.', statement: 'É correto concluir que Carlos não é analista nessa repartição.', answer: 'certo' },
                    ]},
                    { topic: 'Verdades e Mentiras', questions: [
                         { banca: 'FGV', year: '2024', prompt: 'Três servidores, Ana, Bia e Carlos, fizeram uma afirmação. Sabe-se que apenas um deles diz a verdade. Ana diz: "Bia mentiu". Bia diz: "Carlos mentiu". Carlos diz: "Eu não menti".', statement: 'Quem disse a verdade foi Bia.', answer: 'certo' },
                         { banca: 'FGV', year: '2023', prompt: 'Dois suspeitos, A e B, são interrogados. A diz: "B é o culpado". B diz: "A está mentindo". Sabe-se que um deles mente e o outro diz a verdade.', statement: 'É possível concluir que A é o culpado.', answer: 'errado' },
                    ]},
                    { topic: 'Sequências Lógicas', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Considere a sequência: 2, 5, 11, 23, ...', statement: 'O próximo número da sequência, seguindo o padrão lógico, é 47.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Na sequência de palavras (LEI, MESA, CANETA, ...), o critério é o número de letras.', statement: 'A próxima palavra, seguindo a lógica, poderia ser "PROCESSO".', answer: 'certo' },
                    ]},
                     { topic: 'Correlação de Elementos', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'Três amigos (Marcos, Paulo, João) têm três profissões (médico, engenheiro, advogado) e moram em três cidades (Porto Velho, Ji-Paraná, Ariquemes), não necessariamente na mesma ordem. Sabe-se que: 1. Marcos não é médico e não mora em Porto Velho. 2. O engenheiro mora em Ji-Paraná. 3. João é o advogado.', statement: 'É correto concluir que Paulo é o engenheiro e mora em Ji-Paraná.', answer: 'certo' },
                    ]},
                    { topic: 'Análise Combinatória', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'Julgue o item sobre arranjos e combinações.', statement: 'O número de comissões de 3 pessoas que podem ser formadas a partir de um grupo de 5 pessoas é calculado por um arranjo simples.', answer: 'errado' },
                        { banca: 'FGV', year: '2022', prompt: 'Para formar uma senha de 4 dígitos distintos usando os algarismos de 1 a 7.', statement: 'O número de senhas possíveis é calculado pela fórmula de Arranjo de 7 elementos tomados 4 a 4.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'De quantas maneiras distintas 5 servidores podem sentar-se em 5 cadeiras em fila?', statement: 'O número de maneiras é calculado por uma permutação de 5 elementos (5!).', answer: 'certo' },
                    ]},
                    { topic: 'Probabilidade', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Ao lançar um dado não viciado, julgue a probabilidade.', statement: 'A probabilidade de se obter um número par é de 1/2.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Em uma urna com 5 bolas brancas e 3 bolas pretas, retira-se uma bola ao acaso.', statement: 'A probabilidade de a bola retirada ser preta é de 3/8.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Lançando duas moedas, a probabilidade de se obter duas "caras".', statement: 'A probabilidade do evento é de 1/4.', answer: 'certo' },
                    ]}
                ],
                'historia e geografia de rondonia': [
                    { topic: 'Processo de Colonização', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Sobre a colonização de Rondônia, julgue o item.', statement: 'Projetos de colonização agrícola implementados pelo INCRA a partir da década de 1970 foram um fator determinante para o adensamento populacional do estado.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'A ocupação inicial do Vale do Guaporé esteve fortemente ligada à mineração de ouro no período colonial.', statement: 'Esta afirmação está correta e remonta ao século XVIII.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'A Marcha para o Oeste, política do governo de Getúlio Vargas, foi um dos impulsos para a ocupação e integração da região amazônica, incluindo Rondônia.', statement: 'A política de Vargas teve impacto direto na futura criação do Território do Guaporé.', answer: 'certo' },
                    ]},
                    { topic: 'Ciclos Econômicos', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Acerca dos ciclos econômicos que marcaram a história de Rondônia, julgue o item.', statement: 'O primeiro ciclo da borracha, no final do século XIX, foi o principal fator para a construção da Estrada de Ferro Madeira-Mamoré.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'O ciclo da cassiterita, em meados do século XX, atraiu um grande contingente de migrantes para o território, consolidando novos núcleos urbanos.', statement: 'Esta afirmação sobre o ciclo da cassiterita é historicamente precisa.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'O segundo ciclo da borracha está diretamente relacionado à demanda dos Aliados durante a Segunda Guerra Mundial.', statement: 'Os "soldados da borracha" foram trabalhadores nordestinos recrutados para extrair látex na Amazônia nesse período.', answer: 'certo' },
                    ]},
                    { topic: 'Criação do Estado', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Julgue a afirmativa sobre a formação político-administrativa de Rondônia.', statement: 'Rondônia foi elevado à categoria de Estado da Federação em 1981, desmembrando-se do estado do Amazonas.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Antes de se tornar Estado, Rondônia foi um Território Federal, criado em 1943 com o nome de Território Federal do Guaporé.', statement: 'A criação do Território Federal do Guaporé é um marco inicial na autonomia política da região.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'A escolha do nome "Rondônia" para o território foi uma homenagem ao Marechal Cândido Rondon.', statement: 'Rondon foi um sertanista e desbravador de grande importância para a integração da região.', answer: 'certo' },
                    ]},
                    { topic: 'Questões Ambientais', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Sobre a dinâmica ambiental de Rondônia, julgue o item.', statement: 'O "arco do desmatamento" é uma expressão que designa uma área de intensa pressão sobre a floresta amazônica, na qual Rondônia está inserida.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'As hidrelétricas de Santo Antônio e Jirau, construídas no Rio Madeira.', statement: 'São projetos de grande impacto socioambiental no estado, gerando debates sobre desenvolvimento e conservação.', answer: 'certo' },
                    ]},
                    { topic: 'População e Demografia', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'A respeito da composição populacional de Rondônia.', statement: 'A população do estado foi majoritariamente formada por correntes migratórias de outras regiões do Brasil, especialmente do Sul e Sudeste, a partir da segunda metade do século XX.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Porto Velho, a capital do estado.', statement: 'Sua origem está diretamente ligada à construção da Estrada de Ferro Madeira-Mamoré.', answer: 'certo' },
                    ]},
                    { topic: 'Aspectos Físicos e Relevo', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Sobre as características geográficas de Rondônia, julgue o item.', statement: 'O relevo rondoniense é predominantemente caracterizado por planícies e baixas altitudes, sendo parte da planície amazônica.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'O ponto mais elevado do estado é o Pico do Tracuá.', statement: 'Esta afirmação está incorreta; o relevo do estado é de baixa altitude e o Pico do Tracuá não se localiza em Rondônia.', answer: 'errado' },
                    ]},
                    { topic: 'Hidrografia e Clima', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'A respeito do clima de Rondônia, julgue a afirmativa.', statement: 'O clima predominante em Rondônia é o Equatorial, caracterizado por altas temperaturas e elevada umidade, com uma estação seca bem definida.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Os rios Madeira, Mamoré e Guaporé são os principais cursos d\'água que banham o estado.', statement: 'Esses rios pertencem à Bacia Amazônica e têm grande importância econômica e histórica.', answer: 'certo' },
                    ]}
                ],
                'direito constitucional': [
                    { topic: 'Direitos e Garantias Fundamentais (Art. 5º)', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Julgue o item a respeito dos direitos e deveres individuais e coletivos.', statement: 'A casa é asilo inviolável do indivíduo, ninguém nela podendo penetrar sem consentimento do morador, salvo em caso de flagrante delito ou desastre, ou, durante o dia, por determinação judicial.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Sobre a liberdade de associação.', statement: 'A criação de associações e, na forma da lei, a de cooperativas independem de autorização, sendo vedada a interferência estatal em seu funcionamento.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'A respeito dos remédios constitucionais.', statement: 'O mandado de segurança coletivo pode ser impetrado por partido político com representação no Congresso Nacional.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre o direito à propriedade.', statement: 'A pequena propriedade rural, assim definida em lei, desde que trabalhada pela família, não será objeto de penhora para pagamento de débitos decorrentes de sua atividade produtiva.', answer: 'certo' },
                    ]},
                    { topic: 'Direitos Sociais', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre direitos sociais previstos no Art. 6º da CF.', statement: 'A moradia, a alimentação e o transporte são exemplos de direitos sociais expressamente previstos na Constituição Federal.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Sobre o direito de greve.', statement: 'O direito de greve é assegurado aos trabalhadores, competindo a eles decidir sobre a oportunidade de exercê-lo e sobre os interesses que devam por meio dele defender.', answer: 'certo' },
                    ]},
                     { topic: 'Nacionalidade e Direitos Políticos', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'Sobre os cargos privativos de brasileiro nato.', statement: 'O cargo de Presidente do Senado Federal é privativo de brasileiro nato.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre direitos políticos.', statement: 'O alistamento eleitoral e o voto são obrigatórios para os maiores de dezoito anos e facultativos para os analfabetos.', answer: 'certo' },
                    ]},
                    { topic: 'Administração Pública (Art. 37 a 41)', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'Sobre os princípios da Administração Pública, julgue a afirmativa.', statement: 'O princípio da publicidade admite exceções, como nos casos em que a defesa da intimidade ou o interesse social o exigirem.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Sobre a acumulação de cargos, um servidor ocupante de cargo técnico.', statement: 'Um servidor que ocupa um cargo técnico pode acumular com um cargo de professor, desde que haja compatibilidade de horários.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'A investidura em cargo ou emprego público depende de aprovação prévia em concurso público de provas ou de provas e títulos.', statement: 'Esta regra geral não se aplica às nomeações para cargo em comissão, declarado em lei de livre nomeação e exoneração.', answer: 'certo' },
                    ]},
                    { topic: 'Organização do Estado', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Acerca da repartição de competências entre os entes federativos, julgue o item.', statement: 'Compete privativamente à União legislar sobre direito civil, comercial, penal, processual, eleitoral, agrário, marítimo, aeronáutico, espacial e do trabalho.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Julgue o item sobre as competências.', statement: 'Legislar sobre procedimentos em matéria processual é competência concorrente da União, dos Estados e do Distrito Federal.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Sobre a intervenção federal.', statement: 'A União não intervirá nos Estados nem no Distrito Federal, exceto para, entre outras hipóteses, repelir invasão estrangeira ou de uma unidade da Federação em outra.', answer: 'certo' },
                    ]},
                    { topic: 'Poder Legislativo', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Sobre o processo legislativo, julgue a afirmativa.', statement: 'Uma medida provisória, após sua edição pelo Presidente da República, tem força de lei e vigência imediata, mas precisa ser convertida em lei pelo Congresso Nacional para não perder sua eficácia.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Sobre as comissões parlamentares de inquérito (CPI).', statement: 'As CPIs têm poderes de investigação próprios das autoridades judiciais e podem determinar a quebra de sigilo bancário, fiscal e de dados.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'A respeito da imunidade parlamentar.', statement: 'Os Deputados e Senadores são invioláveis, civil e penalmente, por quaisquer de suas opiniões, palavras e votos. Isso se refere à imunidade material.', answer: 'certo' },
                    ]},
                    { topic: 'Controle de Constitucionalidade', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'Acerca do controle de constitucionalidade no Brasil, julgue a afirmativa.', statement: 'Na Ação Direta de Inconstitucionalidade (ADI), a decisão de mérito proferida pelo STF possui eficácia contra todos (erga omnes) e efeito vinculante.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Sobre o controle difuso.', statement: 'Qualquer juiz ou tribunal pode, no julgamento de um caso concreto, declarar incidentalmente a inconstitucionalidade de uma lei.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Sobre a Ação Declaratória de Constitucionalidade (ADC).', statement: 'A ADC visa transformar uma presunção relativa de constitucionalidade de uma lei federal em uma presunção absoluta.', answer: 'certo' },
                    ]}
                ],
                'direito administrativo': [
                    { topic: 'Princípios Administrativos', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'Um agente público, ao aplicar uma multa, age com rigor excessivo e desproporcional à infração cometida.', statement: 'A conduta do agente viola o princípio da razoabilidade e da proporcionalidade.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Um edital de concurso que exige altura mínima para o cargo de técnico administrativo, sem justificativa legal.', statement: 'Este edital fere o princípio da isonomia e da razoabilidade.', answer: 'certo' },
                    ]},
                    { topic: 'Atos Administrativos', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'A respeito dos atributos do ato administrativo, julgue o item.', statement: 'A autoexecutoriedade é o atributo que permite à Administração Pública anular seus próprios atos, quando eivados de vícios que os tornam ilegais.', answer: 'errado' },
                        { banca: 'FGV', year: '2022', prompt: 'Um prefeito desapropria um imóvel para construir uma praça, mas na verdade o utiliza para beneficiar um amigo.', statement: 'O ato administrativo está viciado no elemento "finalidade", caracterizando desvio de poder.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'A anulação de um ato administrativo ilegal.', statement: 'Opera efeitos retroativos (ex tunc), desfazendo as relações jurídicas desde a origem do ato.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'A revogação de um ato administrativo.', statement: 'É feita por motivos de conveniência e oportunidade e opera efeitos prospectivos (ex nunc).', answer: 'certo' },
                    ]},
                    { topic: 'Poderes da Administração', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Julgue a afirmativa sobre o poder de polícia.', statement: 'O poder de polícia pode ser delegado a pessoas jurídicas de direito privado, como empresas públicas, para a execução de sanções.', answer: 'errado' },
                        { banca: 'FGV', year: '2023', prompt: 'O Secretário de Obras avoca para si a competência de um subordinado para decidir sobre um processo específico.', statement: 'Esta é uma manifestação do poder hierárquico.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'A aplicação de uma penalidade a um servidor que cometeu uma infração funcional.', statement: 'Decorre do poder disciplinar da Administração.', answer: 'certo' },
                    ]},
                    { topic: 'Organização da Administração', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'Sobre a Administração Indireta.', statement: 'As autarquias, como o INSS, são pessoas jurídicas de direito público, criadas por lei específica, com autonomia administrativa e financeira.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre empresas estatais.', statement: 'As sociedades de economia mista, como o Banco do Brasil, são pessoas jurídicas de direito privado, com capital misto (público e privado), mas com controle acionário do Poder Público.', answer: 'certo' },
                    ]},
                    { topic: 'Bens Públicos', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Sobre as características dos bens públicos.', statement: 'Os bens de uso comum do povo, como rios e praças, são, em regra, inalienáveis, ou seja, não podem ser vendidos enquanto mantiverem essa qualificação.', answer: 'certo' }
                    ]},
                    { topic: 'Licitações e Contratos (Lei 14.133)', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'De acordo com a Nova Lei de Licitações (Lei nº 14.133/2021), julgue o item.', statement: 'A modalidade de licitação denominada "diálogo competitivo" é restrita a contratações que envolvam inovação tecnológica ou técnica.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'A inexigibilidade de licitação ocorre em situações onde há inviabilidade de competição.', statement: 'A contratação de um artista consagrado pela crítica especializada é um exemplo clássico de inexigibilidade.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'A dispensa de licitação ocorre em casos especificados em lei, onde, embora a competição seja possível, o legislador optou por não exigi-la.', statement: 'A contratação de pequeno valor é um exemplo de dispensa de licitação.', answer: 'certo' },
                    ]},
                    { topic: 'Controle da Administração', questions: [
                        { banca: 'FGV', year: '2022', prompt: 'Sobre o controle exercido pelos Tribunais de Contas.', statement: 'O Tribunal de Contas da União (TCU) aprecia as contas do Presidente da República, mas o julgamento final compete ao Congresso Nacional.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'O controle judicial dos atos administrativos.', statement: 'Incide sobre a legalidade dos atos, não podendo o Poder Judiciário, em regra, analisar o mérito administrativo (conveniência e oportunidade).', answer: 'certo' },
                    ]},
                    { topic: 'Improbidade Administrativa (Lei 8.429)', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Conforme as alterações recentes na Lei de Improbidade Administrativa, julgue a afirmativa.', statement: 'Para a caracterização de ato de improbidade administrativa, é indispensável a comprovação do dolo específico do agente.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Um prefeito que, por mera negligência, causa um pequeno prejuízo ao erário.', statement: 'Após as alterações na Lei de Improbidade, essa conduta culposa não mais caracteriza ato de improbidade administrativa.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Uma das sanções previstas na Lei de Improbidade.', statement: 'A suspensão dos direitos políticos é uma das penalidades aplicáveis aos condenados por improbidade administrativa.', answer: 'certo' },
                    ]}
                ],
                'legislacao especifica': [
                    { topic: 'Constituição do Estado de Rondônia', questions: [
                        { banca: 'FGV', year: '2023', prompt: 'Com base na Constituição do Estado de Rondônia, julgue o item.', statement: 'O Poder Legislativo do Estado de Rondônia é exercido pela Assembleia Legislativa, composta por Deputados Estaduais eleitos pelo sistema majoritário.', answer: 'errado' },
                        { banca: 'FGV', year: '2024', prompt: 'Conforme a Constituição Estadual, compete à Assembleia Legislativa processar e julgar o Governador nos crimes de responsabilidade.', statement: 'Esta é uma das competências privativas da Assembleia Legislativa.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'A Constituição de Rondônia veda a nomeação, para cargo em comissão, de cônjuge ou parente de até segundo grau do Governador.', statement: 'Esta norma estadual configura uma medida contra o nepotismo.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Segundo a Constituição Estadual, o Tribunal de Contas do Estado é composto por sete Conselheiros.', statement: 'Este número está correto conforme a disposição da Constituição de Rondônia.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'A iniciativa popular de projetos de lei é prevista na Constituição Estadual.', statement: 'A Constituição de Rondônia admite a proposição de leis pela população, na forma da lei.', answer: 'certo' },
                    ]},
                    { topic: 'Regimento Interno da ALE-RO', questions: [
                        { banca: 'FGV', year: '2024', prompt: 'De acordo com o Regimento Interno da ALE-RO, julgue a afirmativa.', statement: 'As sessões legislativas ordinárias da Assembleia Legislativa são independentes de convocação e ocorrem em períodos predeterminados anualmente.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Sobre o processo legislativo no âmbito da ALE-RO.', statement: 'Um projeto de lei aprovado pela Assembleia, caso seja vetado pelo Governador, pode ter seu veto derrubado pelo voto da maioria absoluta dos Deputados.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'A respeito da Mesa Diretora da ALE-RO.', statement: 'A Mesa é o órgão de direção dos trabalhos da Assembleia, sendo seus membros eleitos para um mandato de dois anos.', answer: 'certo' },
                        { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre as Comissões Permanentes.', statement: 'As Comissões Permanentes, como a de Constituição e Justiça, têm a função de analisar e emitir parecer sobre as proposições antes de serem votadas em Plenário.', answer: 'certo' },
                        { banca: 'FGV', year: '2022', prompt: 'Sobre o quórum para deliberações em Plenário.', statement: 'Salvo disposição em contrário, as deliberações da Assembleia Legislativa são tomadas por maioria de votos, presente a maioria absoluta de seus membros.', answer: 'certo' },
                        { banca: 'FGV', year: '2024', prompt: 'Um deputado que falta a um terço das sessões ordinárias de uma sessão legislativa.', statement: 'Conforme o Regimento Interno, o deputado pode perder o mandato por falta de decoro parlamentar.', answer: 'certo' },
                    ]}
                ]
            };
            
            function normalizeString(str) {
                if (!str) return '';
                return str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ç/g, "c").replace(/-/g,' ').replace('º','').replace('(','').replace(')','').trim();
            }

            function startQuiz(subjectId, topicId = null) {
                const subject = appState.subjects.find(s => s.id === subjectId);
                if (!subject) return;
                const normalizedSubjectName = normalizeString(subject.name);
                const subjectTopicsData = questionsDB[normalizedSubjectName];
                let questions = [];
                let topicName = null;
                if (topicId) {
                    const topic = subject.topics.find(t => t.id === topicId);
                    if (!topic) return;
                    topicName = topic.name;
                    const normalizedTopicName = normalizeString(topic.name);
                    const topicData = subjectTopicsData?.find(t => normalizeString(t.topic) === normalizedTopicName);
                    questions = topicData?.questions || [];
                } else {
                    if (subjectTopicsData) {
                        questions = subjectTopicsData.flatMap(topicObj => topicObj.questions);
                    }
                }
                if (questions.length > 0) {
                    // Embaralhar as questões para uma nova experiência a cada quiz
                    questions.sort(() => Math.random() - 0.5);
                    appState.quiz = { active: true, subjectName: subject.name, topicName, questions, currentIndex: 0 };
                    switchView('questoes');
                } else {
                    alert(`Nenhuma questão encontrada para "${topicName || subject.name}".`);
                }
            }

            function renderQuizView() {
                if (!appState.currentUser) {
                     quizContainer.innerHTML = `<div class="text-center p-4"><p class="font-semibold text-slate-700">Faça login para praticar com questões.</p></div>`;
                     return;
                }
                if (!appState.quiz.active) {
                    quizContainer.innerHTML = `<div class="text-center p-4"><p class="font-semibold text-slate-700">Pronto para praticar?</p><p class="text-sm text-slate-500 mt-1">Escolha uma disciplina ou assunto e clique em "Praticar".</p></div>`;
                    return;
                }
                const q = appState.quiz.questions[appState.quiz.currentIndex];
                if (!q) {
                    appState.quiz.active = false;
                    quizContainer.innerHTML = `<div class="bg-white p-4 rounded-lg shadow text-center"><h3 class="text-lg font-bold text-blue-600">Parabéns!</h3><p class="mt-2 text-slate-700">Você concluiu o quiz de ${appState.quiz.topicName || appState.quiz.subjectName}.</p><button id="restart-quiz-btn" class="mt-4 w-full bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">Recomeçar</button><button id="back-to-home-btn" class="mt-2 w-full bg-slate-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-slate-700 transition">Voltar ao Início</button></div>`;
                    const subjectForRestart = appState.subjects.find(s=>s.name === appState.quiz.subjectName);
                    if(subjectForRestart) {
                        const topicForRestart = appState.quiz.topicName ? subjectForRestart.topics.find(t=>t.name === appState.quiz.topicName) : null;
                        quizContainer.querySelector('#restart-quiz-btn').addEventListener('click', () => startQuiz(subjectForRestart.id, topicForRestart ? topicForRestart.id : null ));
                    }
                    quizContainer.querySelector('#back-to-home-btn').addEventListener('click', () => switchView('cronometro'));
                    return;
                }
                const quizTitle = appState.quiz.topicName ? `${appState.quiz.subjectName} > ${appState.quiz.topicName}` : appState.quiz.subjectName;
                quizContainer.innerHTML = `<p class="text-sm text-slate-600 mb-4">Praticando: <span class="font-bold">${quizTitle}</span> (${appState.quiz.currentIndex + 1}/${appState.quiz.questions.length})</p><div id="question-container" class="bg-white p-4 rounded-lg shadow"><p class="text-xs text-slate-500">${q.banca} • ${q.year}</p><p class="mt-2">${q.prompt}</p><p class="font-semibold mt-1">${q.statement}</p><div class="flex space-x-4 mt-4 text-sm"><button id="certo-btn" class="bg-green-200 text-green-800 px-4 py-1 rounded-md hover:bg-green-300 transition-colors">Certo</button><button id="errado-btn" class="bg-red-200 text-red-800 px-4 py-1 rounded-md hover:bg-red-300 transition-colors">Errado</button></div><div id="question-feedback" class="mt-4 text-sm font-semibold h-5"></div><button id="next-question-btn" class="hidden mt-4 w-full text-center bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">Próxima Questão</button></div>`;
                quizContainer.querySelector('#certo-btn').addEventListener('click', () => checkAnswer('certo'));
                quizContainer.querySelector('#errado-btn').addEventListener('click', () => checkAnswer('errado'));
                quizContainer.querySelector('#next-question-btn').addEventListener('click', loadNextQuestion);
            }

            function checkAnswer(selectedAnswer) {
                const q = appState.quiz.questions[appState.quiz.currentIndex];
                const feedbackEl = quizContainer.querySelector('#question-feedback');
                quizContainer.querySelector('#certo-btn').disabled = true;
                quizContainer.querySelector('#errado-btn').disabled = true;
                feedbackEl.textContent = selectedAnswer === q.answer ? 'Resposta Correta!' : 'Resposta Incorreta!';
                feedbackEl.className = `mt-4 text-sm font-semibold h-5 ${selectedAnswer === q.answer ? 'text-green-600' : 'text-red-600'}`;
                quizContainer.querySelector('#next-question-btn').classList.remove('hidden');
            }

            function loadNextQuestion() {
                appState.quiz.currentIndex++;
                renderQuizView();
            }

            // --- Event Listeners ---
            addSubjectBtn.addEventListener('click', addSubject);
            setCycleGoalBtn.addEventListener('click', setStudyCycleGoal);
            
            subjectsList.addEventListener('click', (e) => {
                const target = e.target;
                const subjectLi = target.closest('.subject-item');
                if (!subjectLi) return;
                const subjectId = parseInt(subjectLi.dataset.subjectId);

                if (target.closest('[data-toggle-topics-id]')) subjectLi.classList.toggle('is-expanded');
                if (target.closest('[data-add-topic-id]')) {
                    const input = subjectLi.querySelector(`[data-topic-input-id='${subjectId}']`);
                    addTopic(subjectId, input.value.trim());
                    input.value = '';
                }
                if (target.closest('[data-select-subject-id]')) selectItem('subject', subjectId);
                const selectTopicBtn = target.closest('[data-select-topic-id]');
                if (selectTopicBtn) selectItem('topic', parseInt(selectTopicBtn.dataset.parentId), parseFloat(selectTopicBtn.dataset.selectTopicId));
                if (target.closest('[data-delete-subject-id]')) deleteSubject(subjectId);
                const deleteTopicBtn = target.closest('[data-delete-topic-id]');
                if (deleteTopicBtn) deleteTopic(parseInt(deleteTopicBtn.dataset.parentId), parseFloat(deleteTopicBtn.dataset.deleteTopicId));
                if (target.closest('[data-practice-subject-id]')) startQuiz(subjectId);
                const practiceTopicBtn = target.closest('[data-practice-topic-id]');
                if (practiceTopicBtn) startQuiz(parseInt(practiceTopicBtn.dataset.parentId), parseFloat(practiceTopicBtn.dataset.practiceTopicId));
                
                const summaryBtn = target.closest('[data-summary-subject-name]');
                if (summaryBtn) showSummaryModal(summaryBtn.dataset.summarySubjectName);
            });

            subjectsList.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.target.matches('[data-topic-input-id]')) {
                    const subjectId = parseInt(e.target.dataset.topicInputId);
                    addTopic(subjectId, e.target.value.trim());
                    e.target.value = '';
                }
            });
            
            startPauseBtn.addEventListener('click', () => appState.timer.isRunning ? pauseTimer() : startTimer());
            stopBtn.addEventListener('click', stopTimer);
            
            reviewsList.addEventListener('click', (e) => {
                const target = e.target.closest('.complete-review-btn');
                if (target) {
                    completeReview(parseFloat(target.dataset.reviewId));
                }
            });

            // Listener de navegação otimizado
            document.querySelector('nav').addEventListener('click', (e) => {
                const navItem = e.target.closest('.nav-item');
                if (navItem && navItem.dataset.view) {
                    const viewName = navItem.dataset.view;
                    if (viewName === 'questoes' && appState.selectedItem) {
                        const { subjectId, topicId } = appState.selectedItem;
                        startQuiz(subjectId, topicId);
                    } else {
                        switchView(viewName);
                    }
                }
            });

            closeSummaryModalBtn.addEventListener('click', hideSummaryModal);
            summaryModal.addEventListener('click', (e) => {
                if (e.target === summaryModal) hideSummaryModal();
            });

            // Listeners de Autenticação
            showRegisterBtn.addEventListener('click', (e) => { e.preventDefault(); toggleAuthForms(); });
            showLoginBtn.addEventListener('click', (e) => { e.preventDefault(); toggleAuthForms(); });

            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                registerUser(name, email, password);
                registerForm.reset();
            });

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                loginUser(email, password);
                loginForm.reset();
            });

            logoutBtn.addEventListener('click', logoutUser);


            // --- Inicialização ---
            function init() {
                checkLoggedInUser();
            }

            init();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978dffd54c9df190',t:'MTc1NjgyNjUwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
