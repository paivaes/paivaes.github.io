<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GFConcursos - Foco na Aprova√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .timer-digits {
            font-variant-numeric: tabular-nums;
        }
        .view {
            display: none;
        }
        .view.active {
            display: block;
        }
        .nav-item.active {
            color: #2563eb; /* text-blue-600 */
        }
        .nav-item.active svg {
            stroke: #2563eb;
        }
        .topics-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .subject-item.is-expanded .topics-container {
            max-height: 1000px; /* valor alto para permitir expans√£o */
        }
        .subject-item.is-expanded .chevron {
            transform: rotate(180deg);
        }
        /* Estilos do Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 50;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.is-open {
            display: flex;
        }
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            max-width: 90%;
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slide-up 0.3s ease-out;
        }
        @keyframes slide-up {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .summary-content h3 {
          font-size: 1.25rem;
          font-weight: 700;
          color: #1e3a8a; /* text-blue-900 */
          margin-top: 1.5rem;
          margin-bottom: 0.5rem;
          border-bottom: 2px solid #93c5fd; /* border-blue-300 */
          padding-bottom: 0.25rem;
        }
        .summary-content h4 {
          font-size: 1.1rem;
          font-weight: 600;
          color: #1e293b; /* text-slate-800 */
          margin-top: 1.25rem;
          margin-bottom: 0.5rem;
        }
        .summary-content p {
          color: #475569; /* text-slate-600 */
          line-height: 1.6;
          margin-bottom: 0.75rem;
        }
        .summary-content strong {
            font-weight: 600;
            color: #334155; /* text-slate-700 */
        }
        .progress-bar {
            background-color: #e5e7eb; /* bg-gray-200 */
            border-radius: 9999px;
            height: 1rem;
            overflow: hidden;
        }
        .progress-bar-inner {
            background-color: #2563eb; /* bg-blue-600 */
            height: 100%;
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="antialiased text-slate-800">

    <div id="app" class="max-w-lg mx-auto bg-white min-h-screen shadow-lg flex flex-col">
        
        <!-- Cabe√ßalho -->
        <header class="bg-blue-600 text-white p-4 text-center shadow-md">
            <h1 class="text-2xl font-bold">GFConcursos</h1>
            <p id="header-subtitle" class="text-sm opacity-90">Seu parceiro rumo √† aprova√ß√£o</p>
        </header>

        <!-- Conte√∫do Principal -->
        <main class="flex-grow p-4 md:p-6 space-y-6 overflow-y-auto pb-24">
            
            <!-- VIEW: Cron√¥metro -->
            <div id="view-cronometro" class="view active">
                 <!-- Se√ß√£o Ciclo de Estudo -->
                <div id="study-cycle-container" class="mb-6">
                    <h2 class="text-xl font-bold mb-3">Meu Ciclo de Estudo</h2>
                    <div class="bg-white p-4 rounded-lg shadow space-y-3">
                        <div id="cycle-setup">
                             <label for="cycle-goal-input" class="block text-sm font-medium text-slate-700">Definir meta de horas para o ciclo:</label>
                             <div class="flex items-center gap-2 mt-1">
                                 <input type="number" id="cycle-goal-input" placeholder="Ex: 100" min="1" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                                 <button id="set-cycle-goal-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">Definir</button>
                             </div>
                        </div>
                        <div id="cycle-progress" class="hidden space-y-2">
                            <div>
                                <div class="flex justify-between items-center text-sm font-medium text-slate-600">
                                    <span>Progresso</span>
                                    <span id="cycle-progress-percentage">0%</span>
                                </div>
                                <div class="progress-bar mt-1">
                                    <div id="cycle-progress-bar-inner" class="progress-bar-inner" style="width: 0%;"></div>
                                </div>
                                <p id="cycle-progress-text" class="text-xs text-slate-500 text-right mt-1">0h 0m / 0h</p>
                            </div>
                            <div id="cycle-completed-box" class="hidden bg-green-100 border border-green-200 text-green-700 text-center p-3 rounded-lg">
                                <p class="font-bold">üéâ Parab√©ns! Meta do ciclo conclu√≠da! üéâ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o do Timer -->
                <div class="bg-slate-100 rounded-2xl p-6 text-center shadow-inner">
                    <p id="current-subject-display" class="text-lg font-semibold text-slate-600 mb-2 h-12 flex items-center justify-center text-center">Nenhuma disciplina selecionada</p>
                    <div id="timer-display" class="text-6xl md:text-7xl font-bold text-slate-800 timer-digits tracking-wider">
                        00:00:00
                    </div>
                    <div class="mt-6 flex justify-center space-x-3">
                        <button id="start-pause-btn" class="bg-blue-600 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                            <i data-lucide="play" class="w-5 h-5 mr-2"></i>
                            <span id="start-pause-text">Iniciar</span>
                        </button>
                        <button id="stop-btn" class="bg-red-500 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:bg-red-600 transition-all transform hover:scale-105 flex items-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                            <i data-lucide="square" class="w-5 h-5 mr-2"></i>
                            <span>Parar</span>
                        </button>
                    </div>
                </div>

                <!-- Se√ß√£o de Disciplinas -->
                <div>
                    <h2 class="text-xl font-bold mb-3 mt-6">Minhas Disciplinas</h2>
                    <div class="bg-white rounded-lg">
                        <ul id="subjects-list" class="divide-y divide-slate-200">
                            <!-- Disciplinas e assuntos ser√£o inseridos aqui via JS -->
                        </ul>
                    </div>
                     <div id="add-subject-container" class="mt-4 space-y-2">
                         <select id="new-subject-select" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white">
                             <option value="">Selecione uma disciplina do edital...</option>
                             <option value="L√≠ngua Portuguesa">L√≠ngua Portuguesa</option>
                             <option value="Racioc√≠nio L√≥gico-Matem√°tico">Racioc√≠nio L√≥gico-Matem√°tico</option>
                             <option value="Hist√≥ria e Geografia de Rond√¥nia">Hist√≥ria e Geografia de Rond√¥nia</option>
                             <option value="Direito Constitucional">Direito Constitucional</option>
                             <option value="Direito Administrativo">Direito Administrativo</option>
                             <option value="Legisla√ß√£o Espec√≠fica">Legisla√ß√£o Espec√≠fica</option>
                         </select>
                         <div class="flex items-center gap-2">
                            <hr class="flex-grow border-slate-200">
                            <span class="text-xs text-slate-500">OU</span>
                            <hr class="flex-grow border-slate-200">
                         </div>
                         <input type="text" id="custom-subject-input" placeholder="Digite uma disciplina personalizada" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                         <button id="add-subject-btn" class="w-full mt-2 bg-slate-800 text-white px-4 py-2 rounded-lg font-semibold hover:bg-slate-900 transition flex items-center justify-center gap-2">
                             <i data-lucide="plus" class="w-5 h-5"></i>
                             <span>Adicionar</span>
                         </button>
                     </div>
                </div>
            </div>

            <!-- VIEW: Revis√µes -->
            <div id="view-revisoes" class="view">
                <h2 class="text-xl font-bold mb-4">Revis√µes Agendadas</h2>
                <div id="reviews-list" class="space-y-3">
                    <!-- Lista de revis√µes pendentes ser√° inserida aqui -->
                </div>
            </div>

            <!-- VIEW: Salas de Estudo -->
            <div id="view-salas" class="view">
                <h2 class="text-xl font-bold mb-4">Comunidade de Estudos</h2>
                <div id="study-room-list" class="space-y-2">
                    <!-- Usu√°rios reais ser√£o inseridos aqui -->
                </div>
            </div>

            <!-- VIEW: Ranking -->
            <div id="view-ranking" class="view">
                <h2 class="text-xl font-bold mb-4">Ranking Semanal üèÜ</h2>
                <div class="bg-white rounded-lg shadow">
                    <ul id="ranking-list" class="divide-y divide-slate-200">
                       <!-- Ranking din√¢mico ser√° inserido aqui -->
                    </ul>
                </div>
            </div>
            
            <!-- VIEW: Quest√µes -->
            <div id="view-questoes" class="view">
                <h2 class="text-xl font-bold mb-4">Banco de Quest√µes</h2>
                <div id="quiz-container" class="bg-slate-100 p-4 rounded-lg">
                    <!-- O conte√∫do do quiz ser√° renderizado aqui -->
                </div>
            </div>

             <!-- VIEW: Perfil -->
            <div id="view-perfil" class="view">
                <!-- Container para usu√°rio LOGADO -->
                <div id="profile-container" class="hidden">
                    <h2 class="text-2xl font-bold text-center" id="welcome-message"></h2>
                    <p class="text-center text-slate-600 mt-2">Seus dados de estudo est√£o seguros na nuvem.</p>
                    <button id="logout-btn" class="w-full mt-8 bg-red-500 text-white px-4 py-3 rounded-lg font-semibold hover:bg-red-600 transition flex items-center justify-center gap-2">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                        <span>Sair da Conta</span>
                    </button>
                </div>

                <!-- Container para usu√°rio DESLOGADO -->
                <div id="auth-container">
                    <!-- Formul√°rio de Login -->
                    <div id="login-form-container">
                        <h2 class="text-2xl font-bold text-center">Acesse sua Conta</h2>
                        <form id="login-form" class="mt-6 space-y-4">
                            <input type="email" id="login-email" placeholder="Seu e-mail" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <input type="password" id="login-password" placeholder="Sua senha" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <button type="submit" class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">Entrar</button>
                        </form>
                        <p class="text-center text-sm mt-4">
                            N√£o tem uma conta? <a href="#" id="show-register-form" class="font-semibold text-blue-600 hover:underline">Cadastre-se</a>
                        </p>
                    </div>

                    <!-- Formul√°rio de Cadastro -->
                    <div id="register-form-container" class="hidden">
                        <h2 class="text-2xl font-bold text-center">Crie sua Conta</h2>
                        <form id="register-form" class="mt-6 space-y-4">
                            <input type="text" id="register-name" placeholder="Seu nome completo" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <input type="email" id="register-email" placeholder="Seu e-mail" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <input type="password" id="register-password" placeholder="Crie uma senha" required class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                            <button type="submit" class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">Criar Conta</button>
                        </form>
                        <p class="text-center text-sm mt-4">
                            J√° tem uma conta? <a href="#" id="show-login-form" class="font-semibold text-blue-600 hover:underline">Fa√ßa login</a>
                        </p>
                    </div>
                </div>
            </div>

        </main>

        <!-- Navega√ß√£o Inferior -->
        <nav class="fixed bottom-0 left-0 right-0 max-w-lg mx-auto bg-white border-t border-slate-200 flex justify-around p-2 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
            <button class="nav-item active flex flex-col items-center text-slate-500 p-2" data-view="cronometro">
                <i data-lucide="timer" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Cron√¥metro</span>
            </button>
            <button class="nav-item relative flex flex-col items-center text-slate-500 p-2" data-view="revisoes">
                <i data-lucide="repeat" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Revis√µes</span>
                <span id="review-badge" class="hidden absolute top-1 right-2 bg-red-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center"></span>
            </button>
            <button class="nav-item flex flex-col items-center text-slate-500 p-2" data-view="salas">
                <i data-lucide="users" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Salas</span>
            </button>
            <button class="nav-item flex flex-col items-center text-slate-500 p-2" data-view="ranking">
                <i data-lucide="bar-chart-3" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Ranking</span>
            </button>
            <button class="nav-item flex flex-col items-center text-slate-500 p-2" data-view="questoes">
                <i data-lucide="file-question" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Quest√µes</span>
            </button>
             <button class="nav-item flex flex-col items-center text-slate-500 p-2" data-view="perfil">
                <i data-lucide="user-circle" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Perfil</span>
            </button>
        </nav>
    </div>

    <!-- Modal para Resumos -->
    <div id="summary-modal" class="modal-overlay">
        <div class="modal-content relative">
            <button id="close-summary-modal" class="absolute top-2 right-2 text-slate-500 hover:text-slate-800">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 id="summary-modal-title" class="text-2xl font-bold text-blue-700 mb-4"></h2>
            <div id="summary-modal-body" class="summary-content"></div>
        </div>
    </div>

    <script type="module">
        // Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc,
            collection,
            getDocs,
            onSnapshot
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import {
            getDatabase,
            ref,
            set,
            onValue,
            onDisconnect
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // Configura√ß√£o do Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyDqHXjI3lTXMgRWItxaP7An-JZe04YQ-Sg",
          authDomain: "gfconcursos-app.firebaseapp.com",
          databaseURL: "https://gfconcursos-app-default-rtdb.firebaseio.com",
          projectId: "gfconcursos-app",
          storageBucket: "gfconcursos-app.firebasestorage.app",
          messagingSenderId: "615439428502",
          appId: "1:615439428502:web:b399549c3969e052098bb7"
        };

        // Inicializa√ß√£o dos servi√ßos do Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const rtdb = getDatabase(app);

        // --- IN√çCIO DO SCRIPT PRINCIPAL DO APP ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            const appState = {
                subjects: [],
                currentUser: null,
                studyCycle: { goalSeconds: 0, completedSeconds: 0 },
                reviews: [],
                timer: {
                    instance: null,
                    startTime: 0,
                    accumulated: 0,
                    isRunning: false,
                    currentItem: null,
                },
                selectedItem: null,
                quiz: {
                    active: false,
                    subjectName: null,
                    topicName: null,
                    questions: [],
                    currentIndex: 0,
                    score: 0,
                },
                unsubscribeUserDoc: null, 
                unsubscribeUsers: null
            };

            // --- Elementos do DOM ---
            const timerDisplay = document.getElementById('timer-display');
            const startPauseBtn = document.getElementById('start-pause-btn');
            const stopBtn = document.getElementById('stop-btn');
            const newSubjectSelect = document.getElementById('new-subject-select');
            const customSubjectInput = document.getElementById('custom-subject-input');
            const addSubjectBtn = document.getElementById('add-subject-btn');
            const addSubjectContainer = document.getElementById('add-subject-container');
            const subjectsList = document.getElementById('subjects-list');
            const currentSubjectDisplay = document.getElementById('current-subject-display');
            const navItems = document.querySelectorAll('.nav-item');
            const views = document.querySelectorAll('.view');
            const quizContainer = document.getElementById('quiz-container');
            const summaryModal = document.getElementById('summary-modal');
            const summaryModalTitle = document.getElementById('summary-modal-title');
            const summaryModalBody = document.getElementById('summary-modal-body');
            const closeSummaryModalBtn = document.getElementById('close-summary-modal');
            const headerSubtitle = document.getElementById('header-subtitle');
            const cycleGoalInput = document.getElementById('cycle-goal-input');
            const setCycleGoalBtn = document.getElementById('set-cycle-goal-btn');
            const cycleProgress = document.getElementById('cycle-progress');
            const cycleProgressText = document.getElementById('cycle-progress-text');
            const cycleProgressBarInner = document.getElementById('cycle-progress-bar-inner');
            const cycleProgressPercentage = document.getElementById('cycle-progress-percentage');
            const cycleCompletedBox = document.getElementById('cycle-completed-box');
            const reviewsList = document.getElementById('reviews-list');
            const reviewBadge = document.getElementById('review-badge');
            const profileContainer = document.getElementById('profile-container');
            const authContainer = document.getElementById('auth-container');
            const loginFormContainer = document.getElementById('login-form-container');
            const registerFormContainer = document.getElementById('register-form-container');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const showRegisterBtn = document.getElementById('show-register-form');
            const showLoginBtn = document.getElementById('show-login-form');
            const logoutBtn = document.getElementById('logout-btn');
            const welcomeMessage = document.getElementById('welcome-message');
            const studyRoomList = document.getElementById('study-room-list');

            // --- L√≥gica de Persist√™ncia com Firestore ---
            async function saveState() {
                if (auth.currentUser) {
                    const userDocRef = doc(db, 'users', auth.currentUser.uid);
                    try {
                        await setDoc(userDocRef, {
                            subjects: appState.subjects,
                            studyCycle: appState.studyCycle,
                            reviews: appState.reviews,
                            name: auth.currentUser.displayName,
                            email: auth.currentUser.email,
                        }, { merge: true });
                    } catch (error) {
                        console.error("Erro ao salvar dados no Firestore:", error);
                    }
                }
            }
            
            // --- L√≥gica de Autentica√ß√£o e Presen√ßa ---
            onAuthStateChanged(auth, async (user) => {
                // Limpa listeners antigos para evitar duplica√ß√£o
                if (appState.unsubscribeUserDoc) appState.unsubscribeUserDoc();
                if (appState.unsubscribeUsers) {
                    if(appState.unsubscribeUsers.firestore) appState.unsubscribeUsers.firestore();
                    if(appState.unsubscribeUsers.rtdb) appState.unsubscribeUsers.rtdb();
                }

                if (user) {
                    appState.currentUser = user;
                    const userFirestoreRef = doc(db, 'users', user.uid);
                    const userStatusRef = ref(rtdb, 'status/' + user.uid);

                    // Sistema de presen√ßa do Firebase Realtime Database
                    const connectedRef = ref(rtdb, '.info/connected');
                    onValue(connectedRef, (snap) => {
                        if (snap.val() === true) {
                            onDisconnect(userStatusRef).set(false);
                            set(userStatusRef, true);
                        }
                    });

                    appState.unsubscribeUserDoc = onSnapshot(userFirestoreRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            appState.subjects = data.subjects || [];
                            appState.studyCycle = data.studyCycle || { goalSeconds: 0, completedSeconds: 0 };
                            appState.reviews = data.reviews || [];
                            renderSubjects();
                            renderStudyCycle();
                            renderReviews();
                            updateReviewNotification();
                        }
                    });
                    updateUIForLogin();
                } else {
                    appState.currentUser = null;
                    appState.subjects = [];
                    appState.studyCycle = { goalSeconds: 0, completedSeconds: 0 };
                    appState.reviews = [];
                    appState.selectedItem = null;
                    if(appState.timer.isRunning) stopTimer(false); // Para o timer sem salvar
                    updateUIForLogout();
                }
                updateTimerControls();
            });

            function updateUIForLogin() {
                profileContainer.classList.remove('hidden');
                authContainer.classList.add('hidden');
                welcomeMessage.textContent = `Ol√°, ${auth.currentUser.displayName.split(' ')[0]}!`;
                headerSubtitle.textContent = `Bem-vindo(a) de volta!`;
                switchView('cronometro');
            }
            
            function updateUIForLogout() {
                profileContainer.classList.add('hidden');
                authContainer.classList.remove('hidden');
                headerSubtitle.textContent = 'Seu parceiro rumo √† aprova√ß√£o';
                renderSubjects();
                renderStudyCycle();
                updateReviewNotification();
            }

            // --- Fun√ß√µes Auxiliares ---
            function formatTime(seconds) {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                if (h > 0) return `${h.toString()}h ${m.toString().padStart(2, '0')}m`;
                return `${m.toString()}m ${Math.floor(seconds % 60).toString().padStart(2, '0')}s`;
            }
            
            function formatTimeHMS(seconds) {
                const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
                const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                const s = Math.floor(seconds % 60).toString().padStart(2, '0');
                return `${h}:${m}:${s}`;
            }

            // --- Fun√ß√µes Principais do App ---
            
            function renderSubjects() {
                subjectsList.innerHTML = '';
                if (!appState.currentUser) {
                     subjectsList.innerHTML = `<li class="p-4 text-center text-slate-500">Fa√ßa login para ver e adicionar suas disciplinas.</li>`;
                     addSubjectContainer.classList.add('hidden');
                     document.getElementById('study-cycle-container').classList.add('hidden');
                     return;
                }
                addSubjectContainer.classList.remove('hidden');
                document.getElementById('study-cycle-container').classList.remove('hidden');
                if (appState.subjects.length === 0) {
                    subjectsList.innerHTML = `<li class="p-4 text-center text-slate-500">Adicione sua primeira disciplina.</li>`;
                    return;
                }
                appState.subjects.forEach(subject => {
                    const isSelectedSubject = appState.selectedItem?.type === 'subject' && appState.selectedItem.subjectId === subject.id;
                    const li = document.createElement('li');
                    li.className = 'subject-item';
                    li.dataset.subjectId = subject.id;
                    li.dataset.subjectName = subject.name;
                    const topicsHTML = subject.topics.map(topic => {
                        const isSelectedTopic = appState.selectedItem?.type === 'topic' && appState.selectedItem.topicId === topic.id;
                        return `
                            <li class="flex justify-between items-center p-3 transition ${isSelectedTopic ? 'bg-blue-50' : 'hover:bg-slate-50'}">
                                <div class="cursor-pointer flex-grow" data-select-topic-id="${topic.id}" data-parent-id="${subject.id}">
                                    <span class="font-medium text-sm">${topic.name}</span>
                                    <span class="block text-xs text-slate-500">Total: ${formatTimeHMS(topic.totalTime)}</span>
                                </div>
                                <div class="flex items-center space-x-1 pl-1">
                                    <button data-practice-topic-id="${topic.id}" data-parent-id="${subject.id}" class="text-blue-600 hover:text-blue-800 p-1 rounded-full flex items-center text-xs font-semibold"><i data-lucide="file-question" class="w-3 h-3 mr-1"></i> Praticar</button>
                                    <button data-delete-topic-id="${topic.id}" data-parent-id="${subject.id}" class="text-red-500 hover:text-red-700 p-1 rounded-full"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                                </div>
                            </li>`;
                    }).join('');
                    li.innerHTML = `
                        <div class="p-4 flex justify-between items-center transition cursor-pointer ${isSelectedSubject ? 'bg-blue-100' : 'hover:bg-slate-50'}">
                            <div class="flex-grow" data-select-subject-id="${subject.id}" data-toggle-topics-id="${subject.id}">
                                <span class="font-semibold">${subject.name}</span>
                                <span class="block text-sm text-slate-500">Total: ${formatTimeHMS(subject.totalTime)}</span>
                            </div>
                            <div class="flex items-center space-x-2 pl-2">
                               <button data-summary-subject-name="${subject.name}" class="text-indigo-600 hover:text-indigo-800 p-1 rounded-full" title="Ver Resumo"><i data-lucide="book-open" class="w-4 h-4"></i></button>
                               <button data-practice-subject-id="${subject.id}" class="text-blue-600 hover:text-blue-800 p-1 rounded-full" title="Praticar Tudo"><i data-lucide="library" class="w-4 h-4"></i></button>
                               <button data-delete-subject-id="${subject.id}" class="text-red-500 hover:text-red-700 p-1 rounded-full" title="Excluir Disciplina"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                               <i data-lucide="chevron-down" class="w-5 h-5 transition-transform chevron" data-toggle-topics-id="${subject.id}"></i>
                            </div>
                        </div>
                        <div class="topics-container pl-4 border-l-2 border-slate-200 ml-4">
                            <ul class="topic-list divide-y divide-slate-100">${topicsHTML}</ul>
                            <div class="p-2 flex gap-2">
                                <input type="text" data-topic-input-id="${subject.id}" placeholder="Novo assunto" class="flex-grow w-full px-2 py-1 border border-slate-300 rounded-md text-sm">
                                <button data-add-topic-id="${subject.id}" class="bg-slate-600 text-white px-3 py-1 text-sm rounded-md hover:bg-slate-700">Add</button>
                            </div>
                        </div>`;
                    subjectsList.appendChild(li);
                });
                lucide.createIcons();
                updateTimerControls();
            }

            function addSubject() {
                if (!appState.currentUser) return alert("Voc√™ precisa estar logado para adicionar disciplinas.");
                const name = customSubjectInput.value.trim() || newSubjectSelect.value;
                if (name && !appState.subjects.some(s => s.name === name)) {
                    let topics = [];
                    if (!customSubjectInput.value.trim() && newSubjectSelect.value) {
                        const topicsData = questionsDB[normalizeString(newSubjectSelect.value)];
                        if (topicsData) {
                            topics = [...new Set(topicsData.map(t => t.topic))].map(topicName => ({ id: Date.now() + Math.random(), name: topicName, totalTime: 0 }));
                        }
                    }
                    appState.subjects.push({ id: Date.now(), name, totalTime: 0, topics });
                    customSubjectInput.value = '';
                    newSubjectSelect.value = '';
                    saveState(); 
                } else if (name) {
                    alert('Essa disciplina j√° foi adicionada.');
                }
            }

            function addTopic(subjectId, topicName) {
                const subject = appState.subjects.find(s => s.id === subjectId);
                if (subject && topicName) {
                    subject.topics.push({ id: Date.now(), name: topicName, totalTime: 0 });
                    saveState();
                }
            }
            
            function deleteSubject(id) {
                if (appState.timer.isRunning && appState.timer.currentItem?.subjectId === id) stopTimer();
                if (appState.selectedItem?.subjectId === id) appState.selectedItem = null;
                appState.subjects = appState.subjects.filter(s => s.id !== id);
                appState.reviews = appState.reviews.filter(r => r.subjectId !== id);
                saveState();
            }

            function deleteTopic(subjectId, topicId) {
                if (appState.timer.isRunning && appState.timer.currentItem?.topicId === topicId) stopTimer();
                if (appState.selectedItem?.topicId === topicId) appState.selectedItem = null;
                const subject = appState.subjects.find(s => s.id === subjectId);
                if(subject) {
                    subject.topics = subject.topics.filter(t => t.id !== topicId);
                    appState.reviews = appState.reviews.filter(r => r.topicId !== topicId);
                    saveState();
                }
            }
            
            function selectItem(type, subjectId, topicId = null) {
                if (!appState.currentUser) return alert("Fa√ßa login para selecionar uma disciplina.");
                if (appState.timer.isRunning) {
                    const current = appState.timer.currentItem;
                    if(current.type !== type || current.subjectId !== subjectId || current.topicId !== topicId) {
                        return alert('Pare o cron√¥metro atual antes de selecionar outro item.');
                    }
                }
                appState.selectedItem = { type, subjectId, topicId };
                updateCurrentSubjectDisplay();
                renderSubjects();
            }
            
            function updateCurrentSubjectDisplay() {
                 if (!appState.selectedItem) {
                    currentSubjectDisplay.innerHTML = 'Nenhuma disciplina selecionada';
                    return;
                }
                const { type, subjectId, topicId } = appState.selectedItem;
                const subject = appState.subjects.find(s => s.id === subjectId);
                if (!subject) {
                    appState.selectedItem = null;
                    return updateCurrentSubjectDisplay();
                }
                if (type === 'topic') {
                    const topic = subject.topics.find(t => t.id === topicId);
                    if (topic) {
                        currentSubjectDisplay.innerHTML = `Estudando: <span class="font-bold">${subject.name}</span><br/><span class="text-sm">${topic.name}</span>`;
                    } else {
                        appState.selectedItem = null;
                        updateCurrentSubjectDisplay();
                    }
                } else {
                    currentSubjectDisplay.innerHTML = `Estudando: <span class="font-bold">${subject.name}</span>`;
                }
            }

            function updateTimerControls() {
                startPauseBtn.disabled = !(appState.selectedItem && appState.currentUser);
                stopBtn.disabled = !appState.timer.isRunning && appState.timer.accumulated === 0;
            }
            
            function updateDisplay() {
                const elapsed = (Date.now() - appState.timer.startTime) / 1000;
                timerDisplay.textContent = formatTimeHMS(appState.timer.accumulated + elapsed);
            }

            function startTimer() {
                if (appState.timer.isRunning || !appState.selectedItem) return;
                appState.timer.currentItem = { ...appState.selectedItem };
                appState.timer.isRunning = true;
                appState.timer.startTime = Date.now();
                appState.timer.instance = setInterval(updateDisplay, 1000);
                startPauseBtn.innerHTML = `<i data-lucide="pause" class="w-5 h-5 mr-2"></i><span>Pausar</span>`;
                lucide.createIcons();
                stopBtn.disabled = false;
            }

            function pauseTimer() {
                if (!appState.timer.isRunning) return;
                appState.timer.isRunning = false;
                clearInterval(appState.timer.instance);
                appState.timer.accumulated += (Date.now() - appState.timer.startTime) / 1000;
                startPauseBtn.innerHTML = `<i data-lucide="play" class="w-5 h-5 mr-2"></i><span>Continuar</span>`;
                lucide.createIcons();
            }
            
            function stopTimer(shouldSave = true) {
                if (!appState.timer.currentItem) return;
                let finalTime = appState.timer.accumulated;
                if(appState.timer.isRunning) finalTime += (Date.now() - appState.timer.startTime) / 1000;
                
                if (shouldSave) {
                    const { type, subjectId, topicId } = appState.timer.currentItem;
                    const subject = appState.subjects.find(s => s.id === subjectId);
                    if (subject) {
                        subject.totalTime += finalTime;
                        appState.studyCycle.completedSeconds += finalTime;
                        if (type === 'topic') {
                            const topic = subject.topics.find(t => t.id === topicId);
                            if (topic) {
                               topic.totalTime += finalTime;
                               scheduleReviews(subject, topic);
                            }
                        }
                    }
                    saveState();
                }
                
                appState.timer.isRunning = false;
                clearInterval(appState.timer.instance);
                appState.timer.accumulated = 0;
                appState.timer.currentItem = null;
                timerDisplay.textContent = formatTimeHMS(0);
                startPauseBtn.innerHTML = `<i data-lucide="play" class="w-5 h-5 mr-2"></i><span>Iniciar</span>`;
                lucide.createIcons();
            }
            
            function setStudyCycleGoal() {
                const hours = parseFloat(cycleGoalInput.value);
                if (hours && hours > 0) {
                    appState.studyCycle.goalSeconds = hours * 3600;
                    appState.studyCycle.completedSeconds = 0;
                    saveState();
                } else {
                    alert("Por favor, insira um n√∫mero de horas v√°lido.");
                }
            }

            function renderStudyCycle() {
                if (!appState.currentUser || !appState.studyCycle.goalSeconds) {
                    cycleProgress.classList.add('hidden');
                    return;
                }
                cycleProgress.classList.remove('hidden');
                const { goalSeconds, completedSeconds } = appState.studyCycle;
                const percentage = Math.min(100, (completedSeconds / goalSeconds) * 100);
                cycleProgressBarInner.style.width = `${percentage}%`;
                cycleProgressPercentage.textContent = `${Math.floor(percentage)}%`;
                cycleProgressText.textContent = `${formatTime(completedSeconds)} / ${(goalSeconds / 3600).toFixed(1)}h`;
                cycleCompletedBox.classList.toggle('hidden', percentage < 100);
            }

            function scheduleReviews(subject, topic) {
                const today = new Date().toISOString().split('T')[0];
                if (!appState.reviews.some(r => r.topicId === topic.id && r.studyDate === today)) {
                    [1, 7, 21, 30].forEach(days => {
                        const dueDate = new Date();
                        dueDate.setDate(dueDate.getDate() + days);
                        appState.reviews.push({
                            id: Date.now() + Math.random(),
                            subjectId: subject.id,
                            topicId: topic.id,
                            subjectName: subject.name,
                            topicName: topic.name,
                            studyDate: today,
                            days,
                            dueDate: dueDate.toISOString().split('T')[0],
                            isCompleted: false
                        });
                    });
                }
            }
            
            function renderReviews() {
                if (!appState.currentUser) return reviewsList.innerHTML = `<li class="p-4 text-center text-slate-500">Fa√ßa login para ver suas revis√µes.</li>`;
                const pendingReviews = appState.reviews.filter(r => !r.isCompleted).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                if (pendingReviews.length === 0) return reviewsList.innerHTML = `<div class="p-4 text-center bg-green-100 text-green-700 rounded-lg"><p class="font-semibold">Nenhuma revis√£o pendente!</p></div>`;
                const today = new Date();
                today.setHours(0,0,0,0);
                reviewsList.innerHTML = pendingReviews.map(review => {
                    const dueDate = new Date(review.dueDate + 'T00:00:00');
                    const diffDays = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                    let dateInfo = diffDays < 0 ? `<span class="font-bold text-red-600">Atrasada ${Math.abs(diffDays)}d</span>` : diffDays === 0 ? `<span class="font-bold text-yellow-600">Para Hoje</span>` : `<span>Em ${diffDays}d</span>`;
                    return `
                        <div class="bg-white p-3 rounded-lg shadow-sm flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-slate-800">${review.topicName}</p>
                                <p class="text-sm text-slate-500">${review.subjectName} - Rev. de ${review.days} dias</p>
                                <p class="text-xs text-slate-400 mt-1">Vence em: ${dueDate.toLocaleDateString('pt-BR')} (${dateInfo})</p>
                            </div>
                            <button data-review-id="${review.id}" class="complete-review-btn bg-green-500 text-white px-3 py-1 rounded-md font-semibold text-sm hover:bg-green-600 transition">Concluir</button>
                        </div>`;
                }).join('');
            }

            function completeReview(reviewId) {
                // Para simplificar a UX, creditamos um tempo fixo de 15 minutos por revis√£o.
                const minutes = 15; 
                const review = appState.reviews.find(r => r.id === reviewId);
                if (review) {
                    review.isCompleted = true;
                    appState.studyCycle.completedSeconds += minutes * 60;
                    saveState();
                }
            }
            
            function updateReviewNotification() {
                const pendingCount = appState.currentUser ? appState.reviews.filter(r => !r.isCompleted).length : 0;
                reviewBadge.classList.toggle('hidden', pendingCount === 0);
                if (pendingCount > 0) {
                    reviewBadge.textContent = pendingCount;
                }
            }

            function switchView(viewName) {
                views.forEach(view => view.classList.toggle('active', view.id === `view-${viewName}`));
                navItems.forEach(item => item.classList.toggle('active', item.dataset.view === viewName));
                if (viewName === 'salas') renderStudyRoom();
                if (viewName === 'ranking') renderRanking();
            }

            function renderStudyRoom() {
                if (appState.unsubscribeUsers) {
                    if(appState.unsubscribeUsers.firestore) appState.unsubscribeUsers.firestore();
                    if(appState.unsubscribeUsers.rtdb) appState.unsubscribeUsers.rtdb();
                }

                const usersRef = collection(db, "users");
                const statusRef = ref(rtdb, 'status');

                let usersData = {};
                let statusData = {};

                const combineAndRender = () => {
                    const combinedUsers = Object.keys(usersData).map(uid => ({
                        id: uid,
                        ...usersData[uid],
                        isOnline: statusData[uid] === true
                    }));
                    
                    studyRoomList.innerHTML = combinedUsers.map(user => {
                        const statusClass = user.isOnline ? 'text-green-600' : 'text-slate-400';
                        const pulseClass = user.isOnline ? 'animate-pulse' : '';
                        const statusText = user.isOnline ? 'Online' : 'Offline';
                        return `
                        <div class="bg-white p-3 rounded-lg flex items-center justify-between shadow-sm">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-500 mr-3">${user.name ? user.name.charAt(0).toUpperCase() : '?'}</div>
                                <div>
                                    <p class="font-semibold">${user.name || 'Usu√°rio'}</p>
                                    <p class="text-sm text-slate-500">${user.email}</p>
                                </div>
                            </div>
                            <div class="flex items-center ${statusClass}">
                                <div class="w-2 h-2 bg-current rounded-full mr-2 ${pulseClass}"></div>
                                <span class="text-sm font-medium">${statusText}</span>
                            </div>
                        </div>`;
                    }).join('');
                };

                const firestoreUnsubscribe = onSnapshot(usersRef, (snapshot) => {
                    snapshot.docs.forEach(doc => { usersData[doc.id] = doc.data(); });
                    combineAndRender();
                });

                const rtdbUnsubscribe = onValue(statusRef, (snapshot) => {
                    statusData = snapshot.val() || {};
                    combineAndRender();
                });
                
                appState.unsubscribeUsers = { firestore: firestoreUnsubscribe, rtdb: rtdbUnsubscribe };
            }


            async function renderRanking() {
                const usersRef = collection(db, "users");
                const querySnapshot = await getDocs(usersRef);
                const rankingData = [];
                querySnapshot.forEach((doc) => {
                    const userData = doc.data();
                    rankingData.push({
                        name: userData.name || 'Usu√°rio',
                        email: userData.email,
                        totalTime: userData.studyCycle?.completedSeconds || 0
                    });
                });
                rankingData.sort((a, b) => b.totalTime - a.totalTime);
                const rankingList = document.getElementById('ranking-list');
                if (rankingData.length === 0) return rankingList.innerHTML = `<li class="p-4 text-center text-slate-500">Nenhum usu√°rio no ranking.</li>`;
                rankingList.innerHTML = rankingData.map((user, index) => {
                    let rankDisplay = index < 3 ? ['ü•á','ü•à','ü•â'][index] : `${index + 1}`;
                    const isCurrentUser = appState.currentUser && appState.currentUser.email === user.email;
                    return `
                        <li class="p-4 flex items-center ${isCurrentUser ? 'bg-blue-50' : ''}">
                            <span class="text-xl font-bold w-10 text-center">${rankDisplay}</span>
                            <p class="flex-grow font-semibold">${user.name}</p>
                            <p class="text-slate-600 font-medium">${formatTime(user.totalTime)}</p>
                        </li>`;
                }).join('');
            }
             
            // --- Resumos e Quest√µes (L√≥gica Inalterada) ---
            const summariesDB = {
                'lingua portuguesa': `<h3>Vis√£o Geral da Banca FGV</h3><p>Disciplina de grande peso, que valoriza a interpreta√ß√£o e a aplica√ß√£o pr√°tica da gram√°tica. A banca testa o candidato 'cansado', com textos longos e complexos para verificar a aten√ß√£o e a resist√™ncia. O foco √© entender como a gram√°tica constr√≥i o sentido do texto.</p><h4>Interpreta√ß√£o de Textos</h4><p><strong>Foco:</strong> Compreender informa√ß√µes centrais, inferir sentidos, identificar a tese do autor e reconhecer a tipologia textual. <strong>Dica:</strong> Primeiro, leia as perguntas para saber o que procurar no texto. Desconfie de alternativas que generalizam ('sempre', 'nunca') ou extrapolam o que foi dito.</p><h4>Concord√¢ncia Verbal e Nominal</h4><p><strong>Foco:</strong> Rela√ß√£o entre sujeito e verbo, e substantivo e seus determinantes. Cuidado com casos de sujeito composto (especialmente posposto ao verbo), sujeito oracional e verbos impessoais como 'haver' e 'fazer' indicando tempo.</p><h4>Reg√™ncia Verbal e Nominal</h4><p><strong>Foco:</strong> Entender a preposi√ß√£o exigida. Verbos que mudam de sentido com a mudan√ßa de reg√™ncia (aspirar, assistir, visar) s√£o sempre cobrados. Crie uma lista com os mais trai√ßoeiros.</p><h4>Pontua√ß√£o</h4><p><strong>Foco:</strong> Uso da v√≠rgula √© o principal. Estude como isolar ora√ß√µes adjetivas explicativas, adjuntos adverbiais deslocados, apostos e vocativos. A FGV avalia a pontua√ß√£o como elemento que altera a estrutura e o sentido.</p>`,
                'raciocinio logico matematico': `<h3>Vis√£o Geral da Banca FGV</h3><p>Mais do que decorar f√≥rmulas, a FGV exige que voc√™ traduza enunciados em portugu√™s para a linguagem l√≥gica formal. A interpreta√ß√£o correta do problema √© 80% da quest√£o.</p><h4>Estruturas L√≥gicas e L√≥gica Proposicional</h4><p><strong>Foco:</strong> Tabela-verdade, conectivos, nega√ß√µes e equival√™ncias. <strong>Dica:</strong> A equival√™ncia da condicional ('Se P, ent√£o Q' ‚áî 'Se n√£o Q, ent√£o n√£o P' ‚áî 'N√£o P ou Q') √© o item mais cobrado na hist√≥ria da banca. Domine-a!</p><h4>L√≥gica de Argumenta√ß√£o e Diagramas L√≥gicos</h4><p><strong>Foco:</strong> Validade de argumentos e uso de diagramas de Venn (diagramas l√≥gicos) para resolver problemas com quantificadores como 'todo', 'algum' e 'nenhum'. Treine visualizar os conjuntos e suas intersec√ß√µes.</p><h4>An√°lise Combinat√≥ria e Probabilidade</h4><p><strong>Foco:</strong> Saber quando usar arranjo, combina√ß√£o ou permuta√ß√£o. A chave √© se perguntar: 'A ordem dos elementos importa?'. Em probabilidade, o c√°lculo de eventos simples (casos favor√°veis / casos poss√≠veis) √© o mais comum.</p>`,
                'historia e geografia de rondonia': `<h3>Vis√£o Geral</h3><p>Exige conhecimento aprofundado sobre a forma√ß√£o e as caracter√≠sticas do estado. A banca pode usar fotos, mapas antigos ou trechos de jornais para contextualizar as quest√µes.</p><h4>Processo de Coloniza√ß√£o e Ciclos Econ√¥micos</h4><p><strong>Foco:</strong> Entender os ciclos da borracha (e o papel dos 'soldados da borracha'), da cassiterita e da agropecu√°ria. A constru√ß√£o da Estrada de Ferro Madeira-Mamor√© √© um ponto central e deve ser estudada em detalhes, incluindo suas motiva√ß√µes e consequ√™ncias.</p><h4>Cria√ß√£o do Estado</h4><p><strong>Foco:</strong> Memorize o processo: cria√ß√£o do Territ√≥rio Federal do Guapor√© (1943), mudan√ßa para Territ√≥rio de Rond√¥nia (1956) e eleva√ß√£o a Estado (1981). A FGV pode contextualizar com os presidentes da √©poca (Vargas, JK, Figueiredo).</p><h4>Aspectos F√≠sicos</h4><p><strong>Foco:</strong> Conhecer o relevo (predom√≠nio de plan√≠cies), a import√¢ncia dos rios da bacia amaz√¥nica (Madeira, Guapor√©, Mamor√©) e as caracter√≠sticas do clima equatorial (quente e √∫mido).</p>`,
                'direito constitucional': `<h3>Vis√£o Geral da Banca FGV</h3><p>A banca foca na literalidade da Constitui√ß√£o, mas tamb√©m cobra a interpreta√ß√£o consolidada do STF (jurisprud√™ncia sumulada). N√£o basta ler o artigo, √© preciso entender como ele √© aplicado.</p><h4>Direitos e Garantias Fundamentais (Art. 5¬∫)</h4><p><strong>Foco:</strong> Memoriza√ß√£o dos incisos. <strong>Dica:</strong> Agrupe os incisos por tema (direitos individuais, de associa√ß√£o, rem√©dios constitucionais) para facilitar. Entenda a aplicabilidade e os requisitos de cada rem√©dio (Habeas Corpus, Mandado de Seguran√ßa, etc.).</p><h4>Administra√ß√£o P√∫blica (Art. 37 a 41)</h4><p><strong>Foco:</strong> Princ√≠pios da Administra√ß√£o (L.I.M.P.E.), regras de concurso, estabilidade e acumula√ß√£o de cargos. A FGV adora criar casos pr√°ticos sobre acumula√ß√£o.</p><h4>Organiza√ß√£o do Estado</h4><p><strong>Foco:</strong> Reparti√ß√£o de compet√™ncias (Arts. 21 a 24). √â um tema complexo. <strong>Dica:</strong> Crie uma tabela para visualizar o que √© compet√™ncia privativa da Uni√£o, concorrente entre Uni√£o e Estados, e comum a todos.</p>`,
                'direito administrativo': `<h3>Vis√£o Geral da Banca FGV</h3><p>Mat√©ria extremamente relevante. A FGV ama criar 'historinhas' e casos pr√°ticos para testar a aplica√ß√£o da teoria. Ao estudar, imagine-se como um servidor p√∫blico resolvendo o problema.</p><h4>Atos Administrativos</h4><p><strong>Foco:</strong> Atributos (presun√ß√£o de legitimidade, autoexecutoriedade, tipicidade, imperatividade) e os elementos de validade. <strong>Dica:</strong> Decore o mnem√¥nico <strong>COFIFOMOB</strong> (Compet√™ncia, Finalidade, Forma, Motivo, Objeto).</p><h4>Poderes da Administra√ß√£o</h4><p><strong>Foco:</strong> Diferenciar os poderes, especialmente o poder de pol√≠cia (suas fases e limites) do poder disciplinar e hier√°rquico. Entenda a diferen√ßa entre uso e abuso de poder.</p><h4>Licita√ß√µes e Contratos (Lei 14.133/2021)</h4><p><strong>Foco:</strong> Conhecer as novas modalidades (di√°logo competitivo), os princ√≠pios e os crit√©rios de julgamento. N√£o precisa decorar todos os prazos, mas entenda o fluxo geral do processo licitat√≥rio.</p><h4>Improbidade Administrativa</h4><p><strong>Foco:</strong> As atualiza√ß√µes recentes s√£o cruciais. A principal mudan√ßa √© a exig√™ncia de <strong>dolo espec√≠fico</strong> para a caracteriza√ß√£o do ato √≠mprobo. Atos culposos n√£o s√£o mais punidos por esta lei.</p>`,
                'legislacao especifica': `<h3>Vis√£o Geral</h3><p>Aqui, o conhecimento literal das normas √© crucial. A banca costuma trocar uma √∫nica palavra para tornar a alternativa incorreta. O m√©todo de estudo √© a repeti√ß√£o.</p><h4>Constitui√ß√£o do Estado de Rond√¥nia</h4><p><strong>Foco:</strong> D√™ aten√ß√£o especial √†s compet√™ncias da Assembleia Legislativa (Art. 34) e do Governador do Estado (Art. 65). Leia tamb√©m os artigos sobre os servidores p√∫blicos estaduais.</p><h4>Regimento Interno da ALE-RO</h4><p><strong>Foco:</strong> √â um conte√∫do denso. Priorize a composi√ß√£o da Mesa Diretora, o funcionamento das sess√µes (tipos, qu√≥runs) e o processo de tramita√ß√£o das proposi√ß√µes (leis, resolu√ß√µes, etc.). <strong>Dica:</strong> Crie flashcards com os prazos e n√∫meros importantes (qu√≥rum de vota√ß√£o, n√∫mero de deputados nas comiss√µes, etc.).</p>`
            };
            
            function showSummaryModal(subjectName) {
                const summaryHTML = summariesDB[normalizeString(subjectName)];
                if (summaryHTML) {
                    summaryModalTitle.textContent = subjectName;
                    summaryModalBody.innerHTML = summaryHTML;
                    summaryModal.classList.add('is-open');
                } else {
                    alert('Nenhum resumo encontrado para esta disciplina.');
                }
            }

            function hideSummaryModal() {
                summaryModal.classList.remove('is-open');
            }

            const questionsDB = {
                'lingua portuguesa': [ { topic: 'Interpreta√ß√£o de Textos', questions: [ { banca: 'FGV', year: '2023', prompt: 'Considerando o trecho "A persist√™ncia √© o caminho do √™xito", de Charles Chaplin, julgue a afirmativa.', statement: 'O autor sugere que o sucesso √© um evento instant√¢neo, n√£o dependendo de esfor√ßo cont√≠nuo.', answer: 'errado' }, { banca: 'FGV', year: '2022', prompt: 'Em "O homem, que √© um ser racional, muitas vezes age por impulso."', statement: 'A informa√ß√£o de que o homem √© um ser racional √© apresentada como uma verdade universal e indispens√°vel para o sentido da frase.', answer: 'errado' }, { banca: 'FGV', year: '2024', prompt: 'No fragmento "Embora chovesse, fomos √† praia."', statement: 'A ora√ß√£o "Embora chovesse" expressa uma ideia de concess√£o em rela√ß√£o √† ora√ß√£o principal.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Texto: "A tecnologia aproxima os distantes e distancia os pr√≥ximos."', statement: 'O texto constr√≥i seu sentido a partir de uma rela√ß√£o de paradoxo.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'A partir da leitura de um editorial de jornal que critica a burocracia estatal.', statement: '√â correto inferir que a principal fun√ß√£o desse g√™nero textual √© apresentar uma opini√£o sobre um tema relevante.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'No ditado popular "√Ågua mole em pedra dura, tanto bate at√© que fura".', statement: 'A ideia central do prov√©rbio √© a valoriza√ß√£o da insist√™ncia para superar obst√°culos.', answer: 'certo' }, ]}, { topic: 'Concord√¢ncia Verbal e Nominal', questions: [ { banca: 'FGV', year: '2023', prompt: 'Analise a concord√¢ncia na frase a seguir.', statement: 'Na frase "Faz muitos anos que n√£o vejo meus amigos", o verbo "Fazer" est√° empregado corretamente, indicando tempo decorrido.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Julgue a corre√ß√£o da frase.', statement: 'A frase "Houveram muitos problemas na reuni√£o" est√° gramaticalmente correta.', answer: 'errado' }, { banca: 'FGV', year: '2024', prompt: 'Julgue a concord√¢ncia na express√£o "meio-dia e meia".', statement: 'A palavra "meia" concorda com a palavra "hora", que est√° subentendida.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Sobre a frase "A maioria dos concurseiros sonha com a aprova√ß√£o".', statement: 'O verbo "sonha" poderia ser flexionado no plural ("sonham"), concordando com "concurseiros", sem que houvesse erro gramatical.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Julgue a frase "√â proibido entrada de estranhos".', statement: 'A concord√¢ncia est√° correta, pois o sujeito "entrada" n√£o est√° determinado por artigo.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Analise a frase "Segue anexo os documentos solicitados".', statement: 'A concord√¢ncia nominal est√° incorreta; o correto seria "Seguem anexos os documentos solicitados".', answer: 'certo' }, ]}, { topic: 'Reg√™ncia Verbal e Nominal', questions: [ { banca: 'FGV', year: '2022', prompt: 'Julgue a reg√™ncia do verbo "assistir" na frase "O paciente assistiu o m√©dico durante o procedimento".', statement: 'O verbo "assistir", no sentido de "ajudar", √© transitivo direto, portanto a reg√™ncia est√° correta.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Analise a frase "Eu aspiro o cargo de T√©cnico Legislativo".', statement: 'O verbo "aspirar", no sentido de "almejar", exige a preposi√ß√£o "a", sendo a forma correta: "Eu aspiro ao cargo...".', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Julgue a reg√™ncia do verbo "implicar".', statement: 'Na frase "Estudar implica aprova√ß√£o", o verbo "implicar" √© transitivo direto, n√£o exigindo a preposi√ß√£o "em".', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Analise a frase "O filme que assisti ontem foi excelente".', statement: 'A reg√™ncia do verbo "assistir" (no sentido de ver) est√° incorreta, pois ele exige a preposi√ß√£o "a". O correto seria "ao qual assisti".', answer: 'certo' }, ]}, { topic: 'Crase', questions: [ { banca: 'FGV', year: '2024', prompt: 'Sobre o uso do acento indicativo de crase, julgue o item.', statement: 'Na frase "O pesquisador se referiu √†quelas teorias ultrapassadas", o uso da crase √© facultativo.', answer: 'errado' }, { banca: 'FGV', year: '2023', prompt: 'Julgue a frase "Ele foi √† Fran√ßa".', statement: 'O uso do acento indicativo de crase √© obrigat√≥rio, pois o nome do pa√≠s "Fran√ßa" admite o artigo "a".', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Analise a frase "A reuni√£o come√ßar√° √†s 14h".', statement: 'A crase √© obrigat√≥ria antes de locu√ß√µes adverbiais femininas que indicam hora.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Na frase "Ele escreve a l√°pis".', statement: 'O uso da crase antes de "l√°pis" √© incorreto, pois "l√°pis" √© uma palavra masculina.', answer: 'certo' }, ]}, { topic: 'Pontua√ß√£o', questions: [ { banca: 'FGV', year: '2023', prompt: 'Julgue o uso da v√≠rgula na seguinte frase: "O candidato, um jovem muito esfor√ßado, passou no concurso."', statement: 'A v√≠rgula foi utilizada para isolar um aposto explicativo.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Sobre a frase "Quando o edital foi publicado, todos come√ßaram a estudar."', statement: 'A v√≠rgula √© utilizada para separar a ora√ß√£o subordinada adverbial deslocada da ora√ß√£o principal.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Na frase "O diretor solicitou aos servidores: dedica√ß√£o, empenho e pontualidade."', statement: 'Os dois-pontos foram usados para introduzir uma enumera√ß√£o.', answer: 'certo' }, ]}, { topic: 'Morfologia', questions: [ { banca: 'FGV', year: '2024', prompt: 'Na frase "O concurseiro que estuda, passa", analise a fun√ß√£o da palavra "que".', statement: 'A palavra "que" √© um pronome relativo, retomando o termo "concurseiro".', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Em "Estuda-se muito para concursos", analise a part√≠cula "se".', statement: 'A part√≠cula "se" atua como √≠ndice de indetermina√ß√£o do sujeito.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Na frase "Se voc√™ estudar, ser√° aprovado".', statement: 'A palavra "Se" √© uma conjun√ß√£o subordinativa condicional.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Em "O edital √© bastante claro".', statement: 'A palavra "bastante" funciona como um adv√©rbio de intensidade, modificando o adjetivo "claro".', answer: 'certo' }, ]}, { topic: 'Sem√¢ntica', questions: [ { banca: 'FGV', year: '2022', prompt: 'Julgue a rela√ß√£o de sentido entre as palavras "eminente" e "iminente".', statement: 'As palavras s√£o par√¥nimas, ou seja, possuem grafia e pron√∫ncia parecidas, mas significados diferentes.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Na frase "O servidor deferiu o pedido".', statement: 'O verbo "deferir" √© sin√¥nimo de "conceder" ou "atender".', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Analise a frase "Ele acendeu a luz" e "Ele ascendeu na carreira".', statement: 'Os verbos "acender" e "ascender" s√£o hom√¥nimos, pois possuem a mesma pron√∫ncia, mas grafia e significados diferentes.', answer: 'certo' }, ]}, { topic: 'Figuras de Linguagem', questions: [ { banca: 'FGV', year: '2023', prompt: 'Na express√£o "O plen√°rio explodiu em aplausos".', statement: 'Ocorre uma hip√©rbole, que √© a figura do exagero.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Na frase "Aquele servidor √© uma raposa".', statement: 'H√° uma met√°fora, que consiste em uma compara√ß√£o impl√≠cita.', answer: 'certo' }, ]} ],
                'raciocinio logico matematico': [ { topic: 'Estruturas L√≥gicas', questions: [ { banca: 'FGV', year: '2023', prompt: 'Julgue a equival√™ncia l√≥gica.', statement: 'A proposi√ß√£o "Se chove, ent√£o o ch√£o molha" √© logicamente equivalente a "Se o ch√£o n√£o molha, ent√£o n√£o chove".', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Considere a proposi√ß√£o "Jo√£o √© servidor e Maria n√£o √© advogada".', statement: 'A nega√ß√£o dessa proposi√ß√£o √© "Jo√£o n√£o √© servidor ou Maria √© advogada".', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'A proposi√ß√£o "O servidor √© eficiente ou n√£o √© promovido".', statement: 'Sua equival√™ncia l√≥gica, utilizando a regra da condicional, √© "Se o servidor n√£o √© eficiente, ent√£o n√£o √© promovido".', answer: 'certo' }, ]}, { topic: 'L√≥gica de Argumenta√ß√£o', questions: [ { banca: 'FGV', year: '2023', prompt: 'Considere o argumento: "Todos os rondonienses s√£o brasileiros. Jo√£o √© rondoniense. Logo, Jo√£o √© brasileiro."', statement: 'Este argumento √© um exemplo de silogismo v√°lido.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Premissas: 1. Se o processo √© urgente, o analista trabalha. 2. O analista n√£o trabalha.', statement: 'A conclus√£o l√≥gica que se pode extrair √© que "o processo n√£o √© urgente".', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Premissas: 1. Ou Ana estuda, ou Bia viaja. 2. Ana n√£o estuda.', statement: 'A conclus√£o v√°lida do argumento √© que "Bia viaja".', answer: 'certo' }, ]}, { topic: 'Diagramas L√≥gicos', questions: [ { banca: 'FGV', year: '2022', prompt: 'Julgue a representa√ß√£o por diagramas de Venn.', statement: 'A intersec√ß√£o dos conjuntos "Servidores P√∫blicos" e "Advogados" representa os servidores p√∫blicos que tamb√©m s√£o advogados.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Sabe-se que "Algum servidor √© feliz" e "Todo servidor √© competente".', statement: 'A partir dessas premissas, √© correto concluir que "Algum competente √© feliz".', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Em uma reparti√ß√£o, todo analista √© formado em Direito. Se Carlos n√£o √© formado em Direito.', statement: '√â correto concluir que Carlos n√£o √© analista nessa reparti√ß√£o.', answer: 'certo' }, ]}, { topic: 'Verdades e Mentiras', questions: [ { banca: 'FGV', year: '2024', prompt: 'Tr√™s servidores, Ana, Bia e Carlos, fizeram uma afirma√ß√£o. Sabe-se que apenas um deles diz a verdade. Ana diz: "Bia mentiu". Bia diz: "Carlos mentiu". Carlos diz: "Eu n√£o menti".', statement: 'Quem disse a verdade foi Bia.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Dois suspeitos, A e B, s√£o interrogados. A diz: "B √© o culpado". B diz: "A est√° mentindo". Sabe-se que um deles mente e o outro diz a verdade.', statement: '√â poss√≠vel concluir que A √© o culpado.', answer: 'errado' }, ]}, { topic: 'Sequ√™ncias L√≥gicas', questions: [ { banca: 'FGV', year: '2023', prompt: 'Considere a sequ√™ncia: 2, 5, 11, 23, ...', statement: 'O pr√≥ximo n√∫mero da sequ√™ncia, seguindo o padr√£o l√≥gico, √© 47.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Na sequ√™ncia de palavras (LEI, MESA, CANETA, ...), o crit√©rio √© o n√∫mero de letras.', statement: 'A pr√≥xima palavra, seguindo a l√≥gica, poderia ser "PROCESSO".', answer: 'certo' }, ]}, { topic: 'Correla√ß√£o de Elementos', questions: [ { banca: 'FGV', year: '2024', prompt: 'Tr√™s amigos (Marcos, Paulo, Jo√£o) t√™m tr√™s profiss√µes (m√©dico, engenheiro, advogado) e moram em tr√™s cidades (Porto Velho, Ji-Paran√°, Ariquemes), n√£o necessariamente na mesma ordem. Sabe-se que: 1. Marcos n√£o √© m√©dico e n√£o mora em Porto Velho. 2. O engenheiro mora em Ji-Paran√°. 3. Jo√£o √© o advogado.', statement: '√â correto concluir que Paulo √© o engenheiro e mora em Ji-Paran√°.', answer: 'certo' }, ]}, { topic: 'An√°lise Combinat√≥ria', questions: [ { banca: 'FGV', year: '2024', prompt: 'Julgue o item sobre arranjos e combina√ß√µes.', statement: 'O n√∫mero de comiss√µes de 3 pessoas que podem ser formadas a partir de um grupo de 5 pessoas √© calculado por um arranjo simples.', answer: 'errado' }, { banca: 'FGV', year: '2022', prompt: 'Para formar uma senha de 4 d√≠gitos distintos usando os algarismos de 1 a 7.', statement: 'O n√∫mero de senhas poss√≠veis √© calculado pela f√≥rmula de Arranjo de 7 elementos tomados 4 a 4.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'De quantas maneiras distintas 5 servidores podem sentar-se em 5 cadeiras em fila?', statement: 'O n√∫mero de maneiras √© calculado por uma permuta√ß√£o de 5 elementos (5!).', answer: 'certo' }, ]}, { topic: 'Probabilidade', questions: [ { banca: 'FGV', year: '2023', prompt: 'Ao lan√ßar um dado n√£o viciado, julgue a probabilidade.', statement: 'A probabilidade de se obter um n√∫mero par √© de 1/2.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Em uma urna com 5 bolas brancas e 3 bolas pretas, retira-se uma bola ao acaso.', statement: 'A probabilidade de a bola retirada ser preta √© de 3/8.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Lan√ßando duas moedas, a probabilidade de se obter duas "caras".', statement: 'A probabilidade do evento √© de 1/4.', answer: 'certo' }, ]} ],
                'historia e geografia de rondonia': [ { topic: 'Processo de Coloniza√ß√£o', questions: [ { banca: 'FGV', year: '2022', prompt: 'Sobre a coloniza√ß√£o de Rond√¥nia, julgue o item.', statement: 'Projetos de coloniza√ß√£o agr√≠cola implementados pelo INCRA a partir da d√©cada de 1970 foram um fator determinante para o adensamento populacional do estado.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'A ocupa√ß√£o inicial do Vale do Guapor√© esteve fortemente ligada √† minera√ß√£o de ouro no per√≠odo colonial.', statement: 'Esta afirma√ß√£o est√° correta e remonta ao s√©culo XVIII.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'A Marcha para o Oeste, pol√≠tica do governo de Get√∫lio Vargas, foi um dos impulsos para a ocupa√ß√£o e integra√ß√£o da regi√£o amaz√¥nica, incluindo Rond√¥nia.', statement: 'A pol√≠tica de Vargas teve impacto direto na futura cria√ß√£o do Territ√≥rio do Guapor√©.', answer: 'certo' }, ]}, { topic: 'Ciclos Econ√¥micos', questions: [ { banca: 'FGV', year: '2022', prompt: 'Acerca dos ciclos econ√¥micos que marcaram a hist√≥ria de Rond√¥nia, julgue o item.', statement: 'O primeiro ciclo da borracha, no final do s√©culo XIX, foi o principal fator para a constru√ß√£o da Estrada de Ferro Madeira-Mamor√©.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'O ciclo da cassiterita, em meados do s√©culo XX, atraiu um grande contingente de migrantes para o territ√≥rio, consolidando novos n√∫cleos urbanos.', statement: 'Esta afirma√ß√£o sobre o ciclo da cassiterita √© historicamente precisa.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'O segundo ciclo da borracha est√° diretamente relacionado √† demanda dos Aliados durante a Segunda Guerra Mundial.', statement: 'Os "soldados da borracha" foram trabalhadores nordestinos recrutados para extrair l√°tex na Amaz√¥nia nesse per√≠odo.', answer: 'certo' }, ]}, { topic: 'Cria√ß√£o do Estado', questions: [ { banca: 'FGV', year: '2023', prompt: 'Julgue a afirmativa sobre a forma√ß√£o pol√≠tico-administrativa de Rond√¥nia.', statement: 'Rond√¥nia foi elevado √† categoria de Estado da Federa√ß√£o em 1981, desmembrando-se do estado do Amazonas.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Antes de se tornar Estado, Rond√¥nia foi um Territ√≥rio Federal, criado em 1943 com o nome de Territ√≥rio Federal do Guapor√©.', statement: 'A cria√ß√£o do Territ√≥rio Federal do Guapor√© √© um marco inicial na autonomia pol√≠tica da regi√£o.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'A escolha do nome "Rond√¥nia" para o territ√≥rio foi uma homenagem ao Marechal C√¢ndido Rondon.', statement: 'Rondon foi um sertanista e desbravador de grande import√¢ncia para a integra√ß√£o da regi√£o.', answer: 'certo' }, ]}, { topic: 'Quest√µes Ambientais', questions: [ { banca: 'FGV', year: '2023', prompt: 'Sobre a din√¢mica ambiental de Rond√¥nia, julgue o item.', statement: 'O "arco do desmatamento" √© uma express√£o que designa uma √°rea de intensa press√£o sobre a floresta amaz√¥nica, na qual Rond√¥nia est√° inserida.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'As hidrel√©tricas de Santo Ant√¥nio e Jirau, constru√≠das no Rio Madeira.', statement: 'S√£o projetos de grande impacto socioambiental no estado, gerando debates sobre desenvolvimento e conserva√ß√£o.', answer: 'certo' }, ]}, { topic: 'Popula√ß√£o e Demografia', questions: [ { banca: 'FGV', year: '2024', prompt: 'A respeito da composi√ß√£o populacional de Rond√¥nia.', statement: 'A popula√ß√£o do estado foi majoritariamente formada por correntes migrat√≥rias de outras regi√µes do Brasil, especialmente do Sul e Sudeste, a partir da segunda metade do s√©culo XX.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Porto Velho, a capital do estado.', statement: 'Sua origem est√° diretamente ligada √† constru√ß√£o da Estrada de Ferro Madeira-Mamor√©.', answer: 'certo' }, ]}, { topic: 'Aspectos F√≠sicos e Relevo', questions: [ { banca: 'FGV', year: '2022', prompt: 'Sobre as caracter√≠sticas geogr√°ficas de Rond√¥nia, julgue o item.', statement: 'O relevo rondoniense √© predominantemente caracterizado por plan√≠cies e baixas altitudes, sendo parte da plan√≠cie amaz√¥nica.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'O ponto mais elevado do estado √© o Pico do Tracu√°.', statement: 'Esta afirma√ß√£o est√° incorreta; o relevo do estado √© de baixa altitude e o Pico do Tracu√° n√£o se localiza em Rond√¥nia.', answer: 'errado' }, ]}, { topic: 'Hidrografia e Clima', questions: [ { banca: 'FGV', year: '2023', prompt: 'A respeito do clima de Rond√¥nia, julgue a afirmativa.', statement: 'O clima predominante em Rond√¥nia √© o Equatorial, caracterizado por altas temperaturas e elevada umidade, com uma esta√ß√£o seca bem definida.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Os rios Madeira, Mamor√© e Guapor√© s√£o os principais cursos d\'√°gua que banham o estado.', statement: 'Esses rios pertencem √† Bacia Amaz√¥nica e t√™m grande import√¢ncia econ√¥mica e hist√≥rica.', answer: 'certo' }, ]} ],
                'direito constitucional': [ { topic: 'Direitos e Garantias Fundamentais (Art. 5¬∫)', questions: [ { banca: 'FGV', year: '2023', prompt: 'Julgue o item a respeito dos direitos e deveres individuais e coletivos.', statement: 'A casa √© asilo inviol√°vel do indiv√≠duo, ningu√©m nela podendo penetrar sem consentimento do morador, salvo em caso de flagrante delito ou desastre, ou, durante o dia, por determina√ß√£o judicial.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Sobre a liberdade de associa√ß√£o.', statement: 'A cria√ß√£o de associa√ß√µes e, na forma da lei, a de cooperativas independem de autoriza√ß√£o, sendo vedada a interfer√™ncia estatal em seu funcionamento.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'A respeito dos rem√©dios constitucionais.', statement: 'O mandado de seguran√ßa coletivo pode ser impetrado por partido pol√≠tico com representa√ß√£o no Congresso Nacional.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre o direito √† propriedade.', statement: 'A pequena propriedade rural, assim definida em lei, desde que trabalhada pela fam√≠lia, n√£o ser√° objeto de penhora para pagamento de d√©bitos decorrentes de sua atividade produtiva.', answer: 'certo' }, ]}, { topic: 'Direitos Sociais', questions: [ { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre direitos sociais previstos no Art. 6¬∫ da CF.', statement: 'A moradia, a alimenta√ß√£o e o transporte s√£o exemplos de direitos sociais expressamente previstos na Constitui√ß√£o Federal.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Sobre o direito de greve.', statement: 'O direito de greve √© assegurado aos trabalhadores, competindo a eles decidir sobre a oportunidade de exerc√™-lo e sobre os interesses que devam por meio dele defender.', answer: 'certo' }, ]}, { topic: 'Nacionalidade e Direitos Pol√≠ticos', questions: [ { banca: 'FGV', year: '2024', prompt: 'Sobre os cargos privativos de brasileiro nato.', statement: 'O cargo de Presidente do Senado Federal √© privativo de brasileiro nato.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre direitos pol√≠ticos.', statement: 'O alistamento eleitoral e o voto s√£o obrigat√≥rios para os maiores de dezoito anos e facultativos para os analfabetos.', answer: 'certo' }, ]}, { topic: 'Administra√ß√£o P√∫blica (Art. 37 a 41)', questions: [ { banca: 'FGV', year: '2024', prompt: 'Sobre os princ√≠pios da Administra√ß√£o P√∫blica, julgue a afirmativa.', statement: 'O princ√≠pio da publicidade admite exce√ß√µes, como nos casos em que a defesa da intimidade ou o interesse social o exigirem.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Sobre a acumula√ß√£o de cargos, um servidor ocupante de cargo t√©cnico.', statement: 'Um servidor que ocupa um cargo t√©cnico pode acumular com um cargo de professor, desde que haja compatibilidade de hor√°rios.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'A investidura em cargo ou emprego p√∫blico depende de aprova√ß√£o pr√©via em concurso p√∫blico de provas ou de provas e t√≠tulos.', statement: 'Esta regra geral n√£o se aplica √†s nomea√ß√µes para cargo em comiss√£o, declarado em lei de livre nomea√ß√£o e exonera√ß√£o.', answer: 'certo' }, ]}, { topic: 'Organiza√ß√£o do Estado', questions: [ { banca: 'FGV', year: '2023', prompt: 'Acerca da reparti√ß√£o de compet√™ncias entre os entes federativos, julgue o item.', statement: 'Compete privativamente √† Uni√£o legislar sobre direito civil, comercial, penal, processual, eleitoral, agr√°rio, mar√≠timo, aeron√°utico, espacial e do trabalho.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Julgue o item sobre as compet√™ncias.', statement: 'Legislar sobre procedimentos em mat√©ria processual √© compet√™ncia concorrente da Uni√£o, dos Estados e do Distrito Federal.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Sobre a interven√ß√£o federal.', statement: 'A Uni√£o n√£o intervir√° nos Estados nem no Distrito Federal, exceto para, entre outras hip√≥teses, repelir invas√£o estrangeira ou de uma unidade da Federa√ß√£o em outra.', answer: 'certo' }, ]}, { topic: 'Poder Legislativo', questions: [ { banca: 'FGV', year: '2022', prompt: 'Sobre o processo legislativo, julgue a afirmativa.', statement: 'Uma medida provis√≥ria, ap√≥s sua edi√ß√£o pelo Presidente da Rep√∫blica, tem for√ßa de lei e vig√™ncia imediata, mas precisa ser convertida em lei pelo Congresso Nacional para n√£o perder sua efic√°cia.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Sobre as comiss√µes parlamentares de inqu√©rito (CPI).', statement: 'As CPIs t√™m poderes de investiga√ß√£o pr√≥prios das autoridades judiciais e podem determinar a quebra de sigilo banc√°rio, fiscal e de dados.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'A respeito da imunidade parlamentar.', statement: 'Os Deputados e Senadores s√£o inviol√°veis, civil e penalmente, por quaisquer de suas opini√µes, palavras e votos. Isso se refere √† imunidade material.', answer: 'certo' }, ]}, { topic: 'Controle de Constitucionalidade', questions: [ { banca: 'FGV', year: '2024', prompt: 'Acerca do controle de constitucionalidade no Brasil, julgue a afirmativa.', statement: 'Na A√ß√£o Direta de Inconstitucionalidade (ADI), a decis√£o de m√©rito proferida pelo STF possui efic√°cia contra todos (erga omnes) e efeito vinculante.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Sobre o controle difuso.', statement: 'Qualquer juiz ou tribunal pode, no julgamento de um caso concreto, declarar incidentalmente a inconstitucionalidade de uma lei.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Sobre a A√ß√£o Declarat√≥ria de Constitucionalidade (ADC).', statement: 'A ADC visa transformar uma presun√ß√£o relativa de constitucionalidade de uma lei federal em uma presun√ß√£o absoluta.', answer: 'certo' }, ]} ],
                'direito administrativo': [ { topic: 'Princ√≠pios Administrativos', questions: [ { banca: 'FGV', year: '2024', prompt: 'Um agente p√∫blico, ao aplicar uma multa, age com rigor excessivo e desproporcional √† infra√ß√£o cometida.', statement: 'A conduta do agente viola o princ√≠pio da razoabilidade e da proporcionalidade.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Um edital de concurso que exige altura m√≠nima para o cargo de t√©cnico administrativo, sem justificativa legal.', statement: 'Este edital fere o princ√≠pio da isonomia e da razoabilidade.', answer: 'certo' }, ]}, { topic: 'Atos Administrativos', questions: [ { banca: 'FGV', year: '2023', prompt: 'A respeito dos atributos do ato administrativo, julgue o item.', statement: 'A autoexecutoriedade √© o atributo que permite √† Administra√ß√£o P√∫blica anular seus pr√≥prios atos, quando eivados de v√≠cios que os tornam ilegais.', answer: 'errado' }, { banca: 'FGV', year: '2022', prompt: 'Um prefeito desapropria um im√≥vel para construir uma pra√ßa, mas na verdade o utiliza para beneficiar um amigo.', statement: 'O ato administrativo est√° viciado no elemento "finalidade", caracterizando desvio de poder.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'A anula√ß√£o de um ato administrativo ilegal.', statement: 'Opera efeitos retroativos (ex tunc), desfazendo as rela√ß√µes jur√≠dicas desde a origem do ato.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'A revoga√ß√£o de um ato administrativo.', statement: '√â feita por motivos de conveni√™ncia e oportunidade e opera efeitos prospectivos (ex nunc).', answer: 'certo' }, ]}, { topic: 'Poderes da Administra√ß√£o', questions: [ { banca: 'FGV', year: '2022', prompt: 'Julgue a afirmativa sobre o poder de pol√≠cia.', statement: 'O poder de pol√≠cia pode ser delegado a pessoas jur√≠dicas de direito privado, como empresas p√∫blicas, para a execu√ß√£o de san√ß√µes.', answer: 'errado' }, { banca: 'FGV', year: '2023', prompt: 'O Secret√°rio de Obras avoca para si a compet√™ncia de um subordinado para decidir sobre um processo espec√≠fico.', statement: 'Esta √© uma manifesta√ß√£o do poder hier√°rquico.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'A aplica√ß√£o de uma penalidade a um servidor que cometeu uma infra√ß√£o funcional.', statement: 'Decorre do poder disciplinar da Administra√ß√£o.', answer: 'certo' }, ]}, { topic: 'Organiza√ß√£o da Administra√ß√£o', questions: [ { banca: 'FGV', year: '2024', prompt: 'Sobre a Administra√ß√£o Indireta.', statement: 'As autarquias, como o INSS, s√£o pessoas jur√≠dicas de direito p√∫blico, criadas por lei espec√≠fica, com autonomia administrativa e financeira.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre empresas estatais.', statement: 'As sociedades de economia mista, como o Banco do Brasil, s√£o pessoas jur√≠dicas de direito privado, com capital misto (p√∫blico e privado), mas com controle acion√°rio do Poder P√∫blico.', answer: 'certo' }, ]}, { topic: 'Bens P√∫blicos', questions: [ { banca: 'FGV', year: '2022', prompt: 'Sobre as caracter√≠sticas dos bens p√∫blicos.', statement: 'Os bens de uso comum do povo, como rios e pra√ßas, s√£o, em regra, inalien√°veis, ou seja, n√£o podem ser vendidos enquanto mantiverem essa qualifica√ß√£o.', answer: 'certo' } ]}, { topic: 'Licita√ß√µes e Contratos (Lei 14.133)', questions: [ { banca: 'FGV', year: '2024', prompt: 'De acordo com a Nova Lei de Licita√ß√µes (Lei n¬∫ 14.133/2021), julgue o item.', statement: 'A modalidade de licita√ß√£o denominada "di√°logo competitivo" √© restrita a contrata√ß√µes que envolvam inova√ß√£o tecnol√≥gica ou t√©cnica.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'A inexigibilidade de licita√ß√£o ocorre em situa√ß√µes onde h√° inviabilidade de competi√ß√£o.', statement: 'A contrata√ß√£o de um artista consagrado pela cr√≠tica especializada √© um exemplo cl√°ssico de inexigibilidade.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'A dispensa de licita√ß√£o ocorre em casos especificados em lei, onde, embora a competi√ß√£o seja poss√≠vel, o legislador optou por n√£o exigi-la.', statement: 'A contrata√ß√£o de pequeno valor √© um exemplo de dispensa de licita√ß√£o.', answer: 'certo' }, ]}, { topic: 'Controle da Administra√ß√£o', questions: [ { banca: 'FGV', year: '2022', prompt: 'Sobre o controle exercido pelos Tribunais de Contas.', statement: 'O Tribunal de Contas da Uni√£o (TCU) aprecia as contas do Presidente da Rep√∫blica, mas o julgamento final compete ao Congresso Nacional.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'O controle judicial dos atos administrativos.', statement: 'Incide sobre a legalidade dos atos, n√£o podendo o Poder Judici√°rio, em regra, analisar o m√©rito administrativo (conveni√™ncia e oportunidade).', answer: 'certo' }, ]}, { topic: 'Improbidade Administrativa (Lei 8.429)', questions: [ { banca: 'FGV', year: '2023', prompt: 'Conforme as altera√ß√µes recentes na Lei de Improbidade Administrativa, julgue a afirmativa.', statement: 'Para a caracteriza√ß√£o de ato de improbidade administrativa, √© indispens√°vel a comprova√ß√£o do dolo espec√≠fico do agente.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Um prefeito que, por mera neglig√™ncia, causa um pequeno preju√≠zo ao er√°rio.', statement: 'Ap√≥s as altera√ß√µes na Lei de Improbidade, essa conduta culposa n√£o mais caracteriza ato de improbidade administrativa.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Uma das san√ß√µes previstas na Lei de Improbidade.', statement: 'A suspens√£o dos direitos pol√≠ticos √© uma das penalidades aplic√°veis aos condenados por improbidade administrativa.', answer: 'certo' }, ]} ],
                'legislacao especifica': [ { topic: 'Constitui√ß√£o do Estado de Rond√¥nia', questions: [ { banca: 'FGV', year: '2023', prompt: 'Com base na Constitui√ß√£o do Estado de Rond√¥nia, julgue o item.', statement: 'O Poder Legislativo do Estado de Rond√¥nia √© exercido pela Assembleia Legislativa, composta por Deputados Estaduais eleitos pelo sistema majorit√°rio.', answer: 'errado' }, { banca: 'FGV', year: '2024', prompt: 'Conforme a Constitui√ß√£o Estadual, compete √† Assembleia Legislativa processar e julgar o Governador nos crimes de responsabilidade.', statement: 'Esta √© uma das compet√™ncias privativas da Assembleia Legislativa.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'A Constitui√ß√£o de Rond√¥nia veda a nomea√ß√£o, para cargo em comiss√£o, de c√¥njuge ou parente de at√© segundo grau do Governador.', statement: 'Esta norma estadual configura uma medida contra o nepotismo.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Segundo a Constitui√ß√£o Estadual, o Tribunal de Contas do Estado √© composto por sete Conselheiros.', statement: 'Este n√∫mero est√° correto conforme a disposi√ß√£o da Constitui√ß√£o de Rond√¥nia.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'A iniciativa popular de projetos de lei √© prevista na Constitui√ß√£o Estadual.', statement: 'A Constitui√ß√£o de Rond√¥nia admite a proposi√ß√£o de leis pela popula√ß√£o, na forma da lei.', answer: 'certo' }, ]}, { topic: 'Regimento Interno da ALE-RO', questions: [ { banca: 'FGV', year: '2024', prompt: 'De acordo com o Regimento Interno da ALE-RO, julgue a afirmativa.', statement: 'As sess√µes legislativas ordin√°rias da Assembleia Legislativa s√£o independentes de convoca√ß√£o e ocorrem em per√≠odos predeterminados anualmente.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Sobre o processo legislativo no √¢mbito da ALE-RO.', statement: 'Um projeto de lei aprovado pela Assembleia, caso seja vetado pelo Governador, pode ter seu veto derrubado pelo voto da maioria absoluta dos Deputados.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'A respeito da Mesa Diretora da ALE-RO.', statement: 'A Mesa √© o √≥rg√£o de dire√ß√£o dos trabalhos da Assembleia, sendo seus membros eleitos para um mandato de dois anos.', answer: 'certo' }, { banca: 'FGV', year: '2023', prompt: 'Julgue o item sobre as Comiss√µes Permanentes.', statement: 'As Comiss√µes Permanentes, como a de Constitui√ß√£o e Justi√ßa, t√™m a fun√ß√£o de analisar e emitir parecer sobre as proposi√ß√µes antes de serem votadas em Plen√°rio.', answer: 'certo' }, { banca: 'FGV', year: '2022', prompt: 'Sobre o qu√≥rum para delibera√ß√µes em Plen√°rio.', statement: 'Salvo disposi√ß√£o em contr√°rio, as delibera√ß√µes da Assembleia Legislativa s√£o tomadas por maioria de votos, presente a maioria absoluta de seus membros.', answer: 'certo' }, { banca: 'FGV', year: '2024', prompt: 'Um deputado que falta a um ter√ßo das sess√µes ordin√°rias de uma sess√£o legislativa.', statement: 'Conforme o Regimento Interno, o deputado pode perder o mandato por falta de decoro parlamentar.', answer: 'certo' }, ]} ]
            };
            
            function normalizeString(str) {
                return str ? str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/√ß/g, "c").replace(/-/g,' ').replace('¬∫','').replace('(','').replace(')','').trim() : '';
            }

            function startQuiz(subjectId, topicId = null) {
                const subject = appState.subjects.find(s => s.id === subjectId);
                if (!subject) return;
                const normalizedSubjectName = normalizeString(subject.name);
                const subjectTopicsData = questionsDB[normalizedSubjectName];
                let questions = [];
                let topicName = null;
                if (topicId) {
                    const topic = subject.topics.find(t => t.id === topicId);
                    if (!topic) return;
                    topicName = topic.name;
                    const normalizedTopicName = normalizeString(topic.name);
                    const topicData = subjectTopicsData?.find(t => normalizeString(t.topic) === normalizedTopicName);
                    questions = topicData?.questions || [];
                } else {
                    if (subjectTopicsData) {
                        questions = subjectTopicsData.flatMap(topicObj => topicObj.questions);
                    }
                }
                if (questions.length > 0) {
                    questions.sort(() => Math.random() - 0.5);
                    appState.quiz = { active: true, subjectName: subject.name, topicName, questions, currentIndex: 0, score: 0 };
                    renderQuizView(); // Chamar renderQuizView em vez de switchView
                    switchView('questoes');
                } else {
                    alert(`Nenhuma quest√£o encontrada para "${topicName || subject.name}".`);
                }
            }

            function renderQuizView() {
                if (!appState.currentUser) {
                     quizContainer.innerHTML = `<div class="text-center p-4"><p class="font-semibold text-slate-700">Fa√ßa login para praticar com quest√µes.</p></div>`;
                     return;
                }
                if (!appState.quiz.active) {
                    quizContainer.innerHTML = `<div class="text-center p-4"><p class="font-semibold text-slate-700">Pronto para praticar?</p><p class="text-sm text-slate-500 mt-1">Escolha uma disciplina ou assunto e clique em "Praticar".</p></div>`;
                    return;
                }
                const q = appState.quiz.questions[appState.quiz.currentIndex];
                if (!q) {
                    appState.quiz.active = false;
                    const totalQuestions = appState.quiz.questions.length;
                    const score = appState.quiz.score;
                    const percentage = totalQuestions > 0 ? ((score / totalQuestions) * 100).toFixed(1) : 0;
                    quizContainer.innerHTML = `<div class="bg-white p-4 rounded-lg shadow text-center"><h3 class="text-lg font-bold text-blue-600">Quiz Conclu√≠do!</h3><p class="mt-2 text-slate-700">Voc√™ acertou ${score} de ${totalQuestions} quest√µes (${percentage}%).</p><button id="back-to-home-btn" class="mt-4 w-full bg-slate-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-slate-700 transition">Voltar ao In√≠cio</button></div>`;
                    quizContainer.querySelector('#back-to-home-btn').addEventListener('click', () => switchView('cronometro'));
                    return;
                }
                const quizTitle = appState.quiz.topicName ? `${appState.quiz.subjectName} > ${appState.quiz.topicName}` : appState.quiz.subjectName;
                quizContainer.innerHTML = `<p class="text-sm text-slate-600 mb-4">Praticando: <span class="font-bold">${quizTitle}</span> (${appState.quiz.currentIndex + 1}/${appState.quiz.questions.length})</p><div id="question-container" class="bg-white p-4 rounded-lg shadow"><p class="text-xs text-slate-500">${q.banca} ‚Ä¢ ${q.year}</p><p class="mt-2">${q.prompt}</p><p class="font-semibold mt-1">${q.statement}</p><div class="flex space-x-4 mt-4 text-sm"><button id="certo-btn" class="bg-green-200 text-green-800 px-4 py-1 rounded-md hover:bg-green-300 transition-colors">Certo</button><button id="errado-btn" class="bg-red-200 text-red-800 px-4 py-1 rounded-md hover:bg-red-300 transition-colors">Errado</button></div><div id="question-feedback" class="mt-4 text-sm font-semibold h-5"></div><button id="next-question-btn" class="hidden mt-4 w-full text-center bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">Pr√≥xima Quest√£o</button></div>`;
                quizContainer.querySelector('#certo-btn').addEventListener('click', () => checkAnswer('certo'));
                quizContainer.querySelector('#errado-btn').addEventListener('click', () => checkAnswer('errado'));
                quizContainer.querySelector('#next-question-btn').addEventListener('click', loadNextQuestion);
            }

            function checkAnswer(selectedAnswer) {
                const q = appState.quiz.questions[appState.quiz.currentIndex];
                const feedbackEl = quizContainer.querySelector('#question-feedback');
                quizContainer.querySelector('#certo-btn').disabled = true;
                quizContainer.querySelector('#errado-btn').disabled = true;
                if (selectedAnswer === q.answer) {
                    appState.quiz.score++;
                    feedbackEl.textContent = 'Resposta Correta!';
                    feedbackEl.className = `mt-4 text-sm font-semibold h-5 text-green-600`;
                } else {
                    feedbackEl.textContent = 'Resposta Incorreta!';
                    feedbackEl.className = `mt-4 text-sm font-semibold h-5 text-red-600`;
                }
                quizContainer.querySelector('#next-question-btn').classList.remove('hidden');
            }

            function loadNextQuestion() {
                appState.quiz.currentIndex++;
                renderQuizView();
            }

            // --- Event Listeners ---
            addSubjectBtn.addEventListener('click', addSubject);
            setCycleGoalBtn.addEventListener('click', setStudyCycleGoal);
            subjectsList.addEventListener('click', (e) => {
                const target = e.target;
                const subjectLi = target.closest('.subject-item');
                if (!subjectLi) return;
                const subjectId = parseInt(subjectLi.dataset.subjectId);
                if (target.closest('[data-toggle-topics-id]')) subjectLi.classList.toggle('is-expanded');
                if (target.closest('[data-add-topic-id]')) {
                    const input = subjectLi.querySelector(`[data-topic-input-id='${subjectId}']`);
                    addTopic(subjectId, input.value.trim());
                    input.value = '';
                }
                if (target.closest('[data-select-subject-id]')) selectItem('subject', subjectId);
                const selectTopicBtn = target.closest('[data-select-topic-id]');
                if (selectTopicBtn) selectItem('topic', parseInt(selectTopicBtn.dataset.parentId), parseFloat(selectTopicBtn.dataset.selectTopicId));
                if (target.closest('[data-delete-subject-id]')) deleteSubject(subjectId);
                const deleteTopicBtn = target.closest('[data-delete-topic-id]');
                if (deleteTopicBtn) deleteTopic(parseInt(deleteTopicBtn.dataset.parentId), parseFloat(deleteTopicBtn.dataset.deleteTopicId));
                if (target.closest('[data-practice-subject-id]')) startQuiz(subjectId);
                const practiceTopicBtn = target.closest('[data-practice-topic-id]');
                if (practiceTopicBtn) startQuiz(parseInt(practiceTopicBtn.dataset.parentId), parseFloat(practiceTopicBtn.dataset.practiceTopicId));
                const summaryBtn = target.closest('[data-summary-subject-name]');
                if (summaryBtn) showSummaryModal(summaryBtn.dataset.summarySubjectName);
            });

            subjectsList.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.target.matches('[data-topic-input-id]')) {
                    const subjectId = parseInt(e.target.dataset.topicInputId);
                    addTopic(subjectId, e.target.value.trim());
                    e.target.value = '';
                }
            });
            
            startPauseBtn.addEventListener('click', () => appState.timer.isRunning ? pauseTimer() : startTimer());
            stopBtn.addEventListener('click', () => stopTimer(true));
            reviewsList.addEventListener('click', (e) => {
                if (e.target.closest('.complete-review-btn')) {
                    completeReview(parseFloat(e.target.closest('.complete-review-btn').dataset.reviewId));
                }
            });

            document.querySelector('nav').addEventListener('click', (e) => {
                const navItem = e.target.closest('.nav-item');
                if (navItem) switchView(navItem.dataset.view);
            });

            closeSummaryModalBtn.addEventListener('click', hideSummaryModal);
            summaryModal.addEventListener('click', (e) => {
                if (e.target === summaryModal) hideSummaryModal();
            });

            showRegisterBtn.addEventListener('click', (e) => { e.preventDefault(); toggleAuthForms(); });
            showLoginBtn.addEventListener('click', (e) => { e.preventDefault(); toggleAuthForms(); });

            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                createUserWithEmailAndPassword(auth, email, password)
                    .then(async (userCredential) => {
                        await updateProfile(userCredential.user, { displayName: name });
                        
                        const userDocRef = doc(db, 'users', userCredential.user.uid);
                        await setDoc(userDocRef, {
                            name: name,
                            email: email,
                            subjects: [],
                            studyCycle: { goalSeconds: 0, completedSeconds: 0 },
                            reviews: []
                        });
                        
                        // Garante que o usu√°rio apare√ßa imediatamente na lista da comunidade
                        const userStatusRef = ref(rtdb, 'status/' + userCredential.user.uid);
                        await set(userStatusRef, false);

                        alert('Cadastro realizado com sucesso!');
                        registerForm.reset();
                        toggleAuthForms();
                    })
                    .catch((error) => {
                        console.error("Erro no cadastro:", error);
                        alert(`Erro ao cadastrar: ${error.message}`);
                    });
            });

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                signInWithEmailAndPassword(auth, email, password)
                    .catch(err => alert('E-mail ou senha incorretos.'));
            });

            logoutBtn.addEventListener('click', async () => {
                if (auth.currentUser) {
                    const userStatusRef = ref(rtdb, 'status/' + auth.currentUser.uid);
                    await set(userStatusRef, false); // Define como offline ANTES de deslogar
                    await signOut(auth);
                }
            });

            function toggleAuthForms() {
                loginFormContainer.classList.toggle('hidden');
                registerFormContainer.classList.toggle('hidden');
            }
        });
    </script>
</body>
</html>

